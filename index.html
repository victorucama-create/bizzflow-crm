<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bizz Flow CRM - Sistema de Gestão Empresarial Inteligente</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SEU_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-SEU_ID');
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bizzflow-primary: #1a5f7a;
            --bizzflow-secondary: #2a9d8f;
            --bizzflow-accent: #e9c46a;
            --bizzflow-warning: #f4a261;
            --bizzflow-danger: #e76f51;
            --bizzflow-success: #2a9d8f;
            --bizzflow-dark: #264653;
            --bizzflow-light: #f8f9fa;
            --bizzflow-gray: #6c757d;
            --bizzflow-gradient: linear-gradient(135deg, #1a5f7a 0%, #2a9d8f 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
            background: #f8fafc;
        }

        /* Sidebar com design moderno */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--bizzflow-dark) 0%, #1a3c4f 100%);
            color: white;
            position: fixed;
            height: 100vh;
            padding: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(0, 0, 0, 0.1);
        }

        .sidebar-header h2 {
            color: white;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .sidebar-header h2 i {
            color: var(--bizzflow-accent);
            background: rgba(233, 196, 106, 0.1);
            padding: 10px;
            border-radius: 10px;
            font-size: 1.4rem;
        }

        .sidebar-header span {
            color: var(--bizzflow-accent);
            font-weight: 800;
        }

        .sidebar-tagline {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
            padding-left: 52px;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-section {
            padding: 0 0 10px 0;
        }

        .menu-section-title {
            padding: 10px 25px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
            border-left: 4px solid var(--bizzflow-secondary);
            padding-left: 30px;
        }

        .menu-item.active {
            background-color: rgba(42, 157, 143, 0.15);
            border-left: 4px solid var(--bizzflow-secondary);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
            color: var(--bizzflow-accent);
        }

        .menu-item .badge {
            position: absolute;
            right: 20px;
            background-color: var(--bizzflow-danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }

        .menu-item span {
            font-weight: 500;
            font-size: 1rem;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 25px;
            transition: all 0.3s;
            min-height: 100vh;
        }

        /* Topbar moderno */
        .topbar {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-left: 5px solid var(--bizzflow-secondary);
        }

        .page-title-area h1 {
            color: var(--bizzflow-dark);
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .page-title-area p {
            color: var(--bizzflow-gray);
            font-size: 0.95rem;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(42, 157, 143, 0.1);
            padding: 8px 15px;
            border-radius: 50px;
            transition: all 0.3s;
        }

        .user-info:hover {
            background: rgba(42, 157, 143, 0.2);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bizzflow-primary), var(--bizzflow-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(26, 95, 122, 0.3);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--bizzflow-dark);
        }

        .user-role {
            font-size: 0.85rem;
            color: var(--bizzflow-gray);
        }

        /* Notification & Quick Action Icons */
        .topbar-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            border: 1px solid #eaeaea;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--bizzflow-dark);
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .icon-btn:hover {
            background: var(--bizzflow-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 95, 122, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--bizzflow-danger);
            color: white;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Stats Cards Modernos */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-top: 4px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-card:nth-child(1) {
            border-top-color: var(--bizzflow-primary);
        }

        .stat-card:nth-child(2) {
            border-top-color: var(--bizzflow-success);
        }

        .stat-card:nth-child(3) {
            border-top-color: var(--bizzflow-warning);
        }

        .stat-card:nth-child(4) {
            border-top-color: var(--bizzflow-danger);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            flex-shrink: 0;
        }

        .stat-card:nth-child(1) .stat-icon {
            background: linear-gradient(135deg, var(--bizzflow-primary), #2a7a9a);
        }

        .stat-card:nth-child(2) .stat-icon {
            background: linear-gradient(135deg, var(--bizzflow-success), #3bb4a2);
        }

        .stat-card:nth-child(3) .stat-icon {
            background: linear-gradient(135deg, var(--bizzflow-warning), #f6b85d);
        }

        .stat-card:nth-child(4) .stat-icon {
            background: linear-gradient(135deg, var(--bizzflow-danger), #ec8a75);
        }

        .stat-info {
            flex: 1;
        }

        .stat-info h3 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            color: var(--bizzflow-dark);
            font-weight: 700;
        }

        .stat-info p {
            color: var(--bizzflow-gray);
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .trend-up {
            color: #2ecc71;
        }

        .trend-down {
            color: #e74c3c;
        }

        /* Content Boxes */
        .content-box {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #f0f0f0;
            transition: all 0.3s;
        }

        .content-box:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .content-header h2 {
            color: var(--bizzflow-dark);
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content-header h2 i {
            color: var(--bizzflow-secondary);
        }

        /* Tabelas modernas */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #f0f0f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th {
            background-color: #f8fafc;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--bizzflow-dark);
            border-bottom: 2px solid #eaeaea;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 18px 15px;
            border-bottom: 1px solid #f5f5f5;
            color: #555;
        }

        tr:hover {
            background-color: #f9fbfd;
        }

        /* Botões estilizados */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--bizzflow-primary), var(--bizzflow-secondary));
            color: white;
            box-shadow: 0 4px 10px rgba(42, 157, 143, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(42, 157, 143, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: white;
            box-shadow: 0 4px 10px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--bizzflow-primary);
            color: var(--bizzflow-primary);
        }

        .btn-outline:hover {
            background: var(--bizzflow-primary);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-lg {
            padding: 15px 30px;
            font-size: 1.1rem;
        }

        /* Formulários estilizados */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--bizzflow-dark);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: white;
        }

        .form-control:focus {
            border-color: var(--bizzflow-secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.1);
        }

        /* Modais */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .modal-header h2 {
            color: var(--bizzflow-dark);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--bizzflow-gray);
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: #f5f5f5;
            color: var(--bizzflow-danger);
        }

        /* Página de Login */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bizzflow-primary) 0%, var(--bizzflow-dark) 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 450px;
            text-align: center;
            animation: slideUp 0.5s ease-out;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            color: var(--bizzflow-primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .login-logo p {
            color: var(--bizzflow-gray);
            font-size: 1rem;
            margin-top: 10px;
        }

        .login-form {
            margin-top: 30px;
        }

        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .badge-primary {
            background-color: #d1e7ff;
            color: #004085;
        }

        /* Cores da bandeira de Moçambique */
        .mz-flag-green {
            color: #007168;
        }

        .mz-flag-yellow {
            color: #f7d518;
        }

        .mz-flag-black {
            color: #000000;
        }

        .mz-flag-red {
            color: #dc241f;
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
                overflow: visible;
            }
            
            .sidebar-header h2 span,
            .sidebar-tagline,
            .menu-item span,
            .menu-section-title,
            .user-details,
            .menu-item .badge {
                display: none;
            }
            
            .sidebar-header {
                padding: 20px 15px;
            }
            
            .sidebar-header h2 {
                justify-content: center;
            }
            
            .menu-item {
                padding: 20px;
                justify-content: center;
                border-left: none;
                border-right: 4px solid transparent;
            }
            
            .menu-item:hover,
            .menu-item.active {
                border-left: none;
                border-right: 4px solid var(--bizzflow-secondary);
                padding-right: 24px;
            }
            
            .main-content {
                margin-left: 80px;
                padding: 20px;
            }
            
            .topbar {
                padding: 15px 20px;
            }
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .topbar {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .topbar-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .main-content {
                padding: 15px;
            }
        }

        @media (max-width: 576px) {
            .login-box {
                padding: 30px 20px;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
        }

        /* Animações */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--bizzflow-dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--bizzflow-dark) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Progress bars */
        .progress {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--bizzflow-primary), var(--bizzflow-secondary));
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        /* Cards de funcionalidades */
        .feature-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            border-top: 4px solid var(--bizzflow-secondary);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .feature-card i {
            font-size: 2.5rem;
            color: var(--bizzflow-secondary);
            margin-bottom: 20px;
            background: rgba(42, 157, 143, 0.1);
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
        }

        .feature-card h3 {
            color: var(--bizzflow-dark);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .feature-card p {
            color: var(--bizzflow-gray);
            line-height: 1.6;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            color: var(--bizzflow-gray);
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--bizzflow-primary);
        }

        .tab.active {
            color: var(--bizzflow-primary);
            border-bottom-color: var(--bizzflow-primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Alertas */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-success {
            background-color: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
        }

        .alert-warning {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
            color: #721c24;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-left: 5px solid #17a2b8;
            color: #0c5460;
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #121212;
                color: #e0e0e0;
            }
            
            .content-box, .stat-card, .feature-card, .topbar, .modal-content, .login-box {
                background-color: #1e1e1e;
                color: #e0e0e0;
                border-color: #333;
            }
            
            .form-control {
                background-color: #2d2d2d;
                border-color: #444;
                color: #e0e0e0;
            }
            
            th, td {
                border-color: #333;
            }
            
            th {
                background-color: #252525;
            }
            
            tr:hover {
                background-color: #252525;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(42, 157, 143, 0.2);
            border-radius: 50%;
            border-top-color: var(--bizzflow-secondary);
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dashboard específico para investidores */
        .investor-dashboard {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
        }

        .investor-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Dashboard específico para clientes */
        .customer-dashboard {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .customer-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* Estilos para planos e assinaturas */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .plan-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            border: 2px solid #eaeaea;
            position: relative;
            overflow: hidden;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }

        .plan-card.popular {
            border-color: var(--bizzflow-secondary);
            transform: scale(1.05);
        }

        .plan-card.popular:hover {
            transform: scale(1.05) translateY(-5px);
        }

        .plan-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--bizzflow-secondary);
            color: white;
            padding: 8px 20px;
            border-radius: 0 15px 0 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .plan-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--bizzflow-dark);
            margin: 20px 0;
        }

        .plan-price span {
            font-size: 1rem;
            color: var(--bizzflow-gray);
        }

        .plan-features {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .plan-features li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .plan-features li i {
            color: var(--bizzflow-success);
        }

        /* Estilos para importação/exportação */
        .import-export-box {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .import-export-box:hover {
            background: #e9ecef;
            border-color: var(--bizzflow-primary);
        }

        .file-upload-area {
            background: white;
            border: 2px dashed var(--bizzflow-secondary);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
        }

        .file-upload-area.drag-over {
            background: #f0f9ff;
            border-color: var(--bizzflow-primary);
        }

        /* Estilos para templates */
        .template-download {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .template-info h4 {
            margin-bottom: 5px;
            color: var(--bizzflow-dark);
        }

        .template-info p {
            color: var(--bizzflow-gray);
            font-size: 0.9rem;
        }

        /* Estilos para status de assinatura */
        .subscription-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-trial {
            background: #fff3cd;
            color: #856404;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #cce5ff;
            color: #004085;
        }
    </style>
</head>
<body>
    <!-- Tela de Login (Visível Inicialmente) -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1><i class="fas fa-chart-line mz-flag-green"></i> <span class="mz-flag-yellow">Bizz</span> <span class="mz-flag-red">Flow</span></h1>
                <p class="mz-flag-black">Sistema de Gestão Empresarial Inteligente</p>
                <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Edição Premium Moçambique</p>
            </div>
            
            <div class="tabs" style="margin-top: 20px;">
                <div class="tab active" data-tab="login">Login</div>
                <div class="tab" data-tab="investor">Área do Investidor</div>
                <div class="tab" data-tab="customer">Área do Cliente</div>
            </div>
            
            <!-- Login Tab -->
            <div id="loginTab" class="tab-content active">
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="username">Nome de Utilizador</label>
                        <input type="text" id="username" class="form-control" placeholder="admin" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Senha</label>
                        <input type="password" id="password" class="form-control" placeholder="••••••••" required>
                    </div>
                    <div class="form-group" style="text-align: left;">
                        <label>
                            <input type="checkbox" id="rememberMe"> Lembrar-me
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                    </button>
                </form>
                
                <div style="margin-top: 25px; text-align: center; color: #666;">
                    <p><strong>Credenciais de demonstração:</strong></p>
                    <p>Administrador: admin / admin123</p>
                    <p>Gestor: manager / manager123</p>
                    <p>Vendedor: seller / seller123</p>
                </div>
            </div>
            
            <!-- Investor Tab -->
            <div id="investorTab" class="tab-content">
                <div style="text-align: center; margin-bottom: 25px;">
                    <h3 style="color: var(--bizzflow-primary); margin-bottom: 15px;">Área do Investidor</h3>
                    <p style="color: var(--bizzflow-gray);">Acesso a relatórios financeiros, métricas de performance e dashboard de investimentos</p>
                </div>
                
                <form id="investorLoginForm">
                    <div class="form-group">
                        <label for="investorEmail">Email do Investidor</label>
                        <input type="email" id="investorEmail" class="form-control" placeholder="investidor@exemplo.com" required>
                    </div>
                    <div class="form-group">
                        <label for="investorPassword">Senha</label>
                        <input type="password" id="investorPassword" class="form-control" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="btn btn-success btn-lg" style="width: 100%;">
                        <i class="fas fa-chart-line"></i> Aceder Dashboard de Investimentos
                    </button>
                </form>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(42, 157, 143, 0.1); border-radius: 10px;">
                    <p style="font-size: 0.9rem; color: var(--bizzflow-dark);">
                        <i class="fas fa-info-circle"></i> <strong>Para Investidores:</strong> Aceda a relatórios detalhados de ROI, fluxo de caixa, métricas de crescimento e projeções financeiras.
                    </p>
                </div>
            </div>
            
            <!-- Customer Tab -->
            <div id="customerTab" class="tab-content">
                <div style="text-align: center; margin-bottom: 25px;">
                    <h3 style="color: var(--bizzflow-primary); margin-bottom: 15px;">Área do Cliente</h3>
                    <p style="color: var(--bizzflow-gray);">Acompanhe suas encomendas, histórico de compras e ofertas especiais</p>
                </div>
                
                <form id="customerLoginForm">
                    <div class="form-group">
                        <label for="customerPhone">Telefone ou Email</label>
                        <input type="text" id="customerPhone" class="form-control" placeholder="+258 84 123 4567 ou cliente@exemplo.com" required>
                    </div>
                    <div class="form-group">
                        <label for="customerCode">Código de Acesso</label>
                        <input type="password" id="customerCode" class="form-control" placeholder="Código do recibo ou senha" required>
                    </div>
                    <button type="submit" class="btn btn-warning btn-lg" style="width: 100%;">
                        <i class="fas fa-shopping-cart"></i> Aceder Minha Área
                    </button>
                </form>
                
                <div style="margin-top: 20px; text-align: center;">
                    <p style="color: var(--bizzflow-gray); font-size: 0.9rem;">É novo cliente? <a href="#" style="color: var(--bizzflow-primary); font-weight: 600;">Registe-se aqui</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Aplicação Principal (Oculta Inicialmente) -->
    <div id="appContainer" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-chart-line"></i> <span>Bizz</span> <span style="color: var(--bizzflow-accent);">Flow</span></h2>
                <div class="sidebar-tagline">Gestão Empresarial Inteligente</div>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">Principal</div>
                    <div class="menu-item active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                        <div class="badge">10</div>
                    </div>
                    <div class="menu-item" data-page="clientes">
                        <i class="fas fa-users"></i>
                        <span>Clientes</span>
                        <div class="badge">24</div>
                    </div>
                    <div class="menu-item" data-page="produtos">
                        <i class="fas fa-boxes"></i>
                        <span>Produtos</span>
                        <div class="badge">3</div>
                    </div>
                    <div class="menu-item" data-page="vendas">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Vendas</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Financeiro</div>
                    <div class="menu-item" data-page="financeiro">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Financeiro</span>
                    </div>
                    <div class="menu-item" data-page="relatorios">
                        <i class="fas fa-chart-bar"></i>
                        <span>Relatórios</span>
                    </div>
                    <div class="menu-item" data-page="investimentos">
                        <i class="fas fa-chart-line"></i>
                        <span>Investimentos</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Assinaturas</div>
                    <div class="menu-item" data-page="planos">
                        <i class="fas fa-crown"></i>
                        <span>Planos</span>
                    </div>
                    <div class="menu-item" data-page="assinaturas">
                        <i class="fas fa-file-contract"></i>
                        <span>Assinaturas</span>
                        <div class="badge">5</div>
                    </div>
                    <div class="menu-item" data-page="exportar">
                        <i class="fas fa-file-export"></i>
                        <span>Importar/Exportar</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Operações</div>
                    <div class="menu-item" data-page="stock">
                        <i class="fas fa-warehouse"></i>
                        <span>Gestão de Stock</span>
                    </div>
                    <div class="menu-item" data-page="fornecedores">
                        <i class="fas fa-truck"></i>
                        <span>Fornecedores</span>
                    </div>
                    <div class="menu-item" data-page="encomendas">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Encomendas</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Administração</div>
                    <div class="menu-item" data-page="equipa">
                        <i class="fas fa-user-tie"></i>
                        <span>Equipa</span>
                    </div>
                    <div class="menu-item" data-page="configuracoes">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </div>
                    <div class="menu-item" data-page="suporte">
                        <i class="fas fa-headset"></i>
                        <span>Suporte</span>
                    </div>
                </div>
            </div>

            <div style="position: absolute; bottom: 0; width: 100%; padding: 20px; background: rgba(0, 0, 0, 0.1); border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="user-info" style="color: white; border: none; background: transparent; padding: 0;">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div id="currentUserName" class="user-name">Administrador</div>
                        <div id="currentUserRole" class="user-role">Super Admin</div>
                    </div>
                </div>
                <button class="btn btn-danger" style="width: 100%; margin-top: 15px; border-radius: 8px;" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> <span>Sair</span>
                </button>
                <div style="text-align: center; margin-top: 15px;">
                    <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6);">Bizz Flow v2.0</div>
                    <div style="font-size: 0.7rem; color: rgba(255, 255, 255, 0.5);">© 2024 Moçambique</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="page-title-area">
                    <h1 id="pageTitle">Dashboard</h1>
                    <p id="pageSubtitle">Visão geral do seu negócio em tempo real</p>
                </div>
                
                <div class="topbar-actions">
                    <div class="topbar-icons">
                        <div class="icon-btn tooltip" id="notificationBtn">
                            <i class="fas fa-bell"></i>
                            <div class="notification-badge">3</div>
                            <span class="tooltip-text">Notificações</span>
                        </div>
                        <div class="icon-btn tooltip" id="quickSaleBtn">
                            <i class="fas fa-cash-register"></i>
                            <span class="tooltip-text">Venda Rápida</span>
                        </div>
                        <div class="icon-btn tooltip" id="helpBtn">
                            <i class="fas fa-question-circle"></i>
                            <span class="tooltip-text">Ajuda</span>
                        </div>
                    </div>
                    
                    <div class="user-info">
                        <div class="user-avatar" id="topbarUserAvatar">A</div>
                        <div class="user-details">
                            <div id="topbarUserName" class="user-name">Administrador</div>
                            <div class="user-role">
                                <span id="currentDate" style="font-weight: 600;"></span>
                                <span style="margin-left: 10px;">Maputo, MZ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page-content">
                <!-- Alertas -->
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Stock Baixo:</strong> 3 produtos estão com stock abaixo do mínimo recomendado.
                        <a href="#" style="margin-left: 10px; color: var(--bizzflow-primary); font-weight: 600;">Ver Produtos</a>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalVendas">0 MZN</h3>
                            <p>Total de Vendas</p>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>12% vs mês anterior</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalClientes">0</h3>
                            <p>Clientes Registados</p>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>5% vs mês anterior</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalProdutos">0</h3>
                            <p>Produtos em Stock</p>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span>8% vs mês anterior</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="vendasHoje">0</h3>
                            <p>Vendas Hoje</p>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span>15% vs ontem</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cards de Funcionalidades -->
                <div class="feature-cards">
                    <div class="feature-card">
                        <i class="fas fa-bolt"></i>
                        <h3>Venda Rápida</h3>
                        <p>Realize vendas de forma rápida e eficiente com o nosso sistema de checkout otimizado.</p>
                        <button class="btn btn-primary btn-sm" style="margin-top: 15px;">
                            <i class="fas fa-play"></i> Iniciar Venda
                        </button>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-chart-pie"></i>
                        <h3>Análise de Dados</h3>
                        <p>Obtenha insights valiosos sobre o seu negócio com relatórios detalhados e personalizáveis.</p>
                        <button class="btn btn-primary btn-sm" style="margin-top: 15px;">
                            <i class="fas fa-chart-bar"></i> Ver Relatórios
                        </button>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-mobile-alt"></i>
                        <h3>App Móvel</h3>
                        <p>Aceda ao Bizz Flow em qualquer lugar com a nossa aplicação móvel disponível para iOS e Android.</p>
                        <button class="btn btn-primary btn-sm" style="margin-top: 15px;">
                            <i class="fas fa-download"></i> Baixar App
                        </button>
                    </div>
                </div>

                <!-- Vendas Recentes -->
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-history"></i> Vendas Recentes</h2>
                        <div>
                            <button class="btn btn-outline btn-sm">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                            <button class="btn btn-primary btn-sm" id="novaVendaBtn">
                                <i class="fas fa-plus"></i> Nova Venda
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="recentSalesTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Data</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="recentSalesBody">
                                <!-- Sales will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-outline">
                            <i class="fas fa-sync-alt"></i> Carregar Mais Vendas
                        </button>
                    </div>
                </div>

                <!-- Alertas de Stock -->
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-exclamation-triangle"></i> Alertas de Stock</h2>
                        <button class="btn btn-warning btn-sm" id="reporStockBtn">
                            <i class="fas fa-boxes"></i> Repor Stock
                        </button>
                    </div>
                    <div class="table-container">
                        <table id="stockAlertTable">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Categoria</th>
                                    <th>Stock Atual</th>
                                    <th>Stock Mínimo</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="stockAlertBody">
                                <!-- Stock alerts will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Gráficos de Performance -->
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-chart-line"></i> Performance do Mês</h2>
                        <div>
                            <select id="chartPeriod" class="form-control" style="width: auto; display: inline-block;">
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este Mês</option>
                                <option value="quarter">Este Trimestre</option>
                                <option value="year">Este Ano</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Vendas Diárias</h3>
                            <canvas id="salesChart" height="250"></canvas>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Top Categorias</h3>
                            <canvas id="categoryChart" height="250"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clientes Page -->
            <div id="clientesPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-users"></i> Gestão de Clientes</h2>
                        <div>
                            <input type="text" class="form-control" placeholder="Buscar cliente..." style="width: 250px; display: inline-block; margin-right: 10px;">
                            <button class="btn btn-primary" id="novoClienteBtn">
                                <i class="fas fa-plus"></i> Novo Cliente
                            </button>
                        </div>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-client-tab="all">Todos Clientes</div>
                        <div class="tab" data-client-tab="active">Clientes Ativos</div>
                        <div class="tab" data-client-tab="vip">Clientes VIP</div>
                        <div class="tab" data-client-tab="inactive">Inativos</div>
                    </div>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table id="clientesTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Telefone</th>
                                    <th>Email</th>
                                    <th>Tipo</th>
                                    <th>Total Compras</th>
                                    <th>Última Compra</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="clientesBody">
                                <!-- Clients will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px;">
                        <div>
                            <span style="color: var(--bizzflow-gray); font-size: 0.9rem;">Mostrando <span id="clientCount">0</span> de <span id="totalClients">0</span> clientes</span>
                        </div>
                        <div>
                            <button class="btn btn-outline btn-sm" onclick="exportData('clientes', 'excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('clientes', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('clientes', 'csv')">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estatísticas de Clientes -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalClientesCount">0</h3>
                            <p>Total de Clientes</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="vipClientesCount">0</h3>
                            <p>Clientes VIP</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="clientesAtivosCount">0</h3>
                            <p>Clientes Ativos</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="clientesInativosCount">0</h3>
                            <p>Clientes Inativos</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Produtos Page -->
            <div id="produtosPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-boxes"></i> Gestão de Produtos</h2>
                        <div>
                            <input type="text" class="form-control" placeholder="Buscar produto..." style="width: 250px; display: inline-block; margin-right: 10px;">
                            <button class="btn btn-primary" id="novoProdutoBtn">
                                <i class="fas fa-plus"></i> Novo Produto
                            </button>
                            <button class="btn btn-warning btn-sm" id="importarProdutosBtn" style="margin-left: 10px;">
                                <i class="fas fa-file-import"></i> Importar
                            </button>
                        </div>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-product-tab="all">Todos Produtos</div>
                        <div class="tab" data-product-tab="low">Stock Baixo</div>
                        <div class="tab" data-product-tab="out">Esgotados</div>
                        <div class="tab" data-product-tab="categories">Categorias</div>
                    </div>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table id="produtosTable">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Produto</th>
                                    <th>Categoria</th>
                                    <th>Preço (MZN)</th>
                                    <th>Custo</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="produtosBody">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px;">
                        <div>
                            <span style="color: var(--bizzflow-gray); font-size: 0.9rem;">Mostrando <span id="productCount">0</span> produtos</span>
                        </div>
                        <div>
                            <button class="btn btn-outline btn-sm" onclick="exportData('produtos', 'excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('produtos', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('produtos', 'csv')">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estatísticas de Produtos -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #1abc9c, #16a085);">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalProdutosCount">0</h3>
                            <p>Total de Produtos</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #e67e22, #d35400);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="produtosStockBaixo">0</h3>
                            <p>Produtos com Stock Baixo</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="produtosEsgotados">0</h3>
                            <p>Produtos Esgotados</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalCategorias">0</h3>
                            <p>Categorias</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendas Page -->
            <div id="vendasPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-shopping-cart"></i> Gestão de Vendas</h2>
                        <div>
                            <input type="text" class="form-control" placeholder="Buscar venda..." style="width: 250px; display: inline-block; margin-right: 10px;">
                            <button class="btn btn-primary" id="novaVendaModalBtn">
                                <i class="fas fa-plus"></i> Nova Venda
                            </button>
                        </div>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-sale-tab="today">Hoje</div>
                        <div class="tab" data-sale-tab="week">Esta Semana</div>
                        <div class="tab" data-sale-tab="month">Este Mês</div>
                        <div class="tab" data-sale-tab="all">Todas</div>
                    </div>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table id="vendasTable">
                            <thead>
                                <tr>
                                    <th>Recibo Nº</th>
                                    <th>Cliente</th>
                                    <th>Data/Hora</th>
                                    <th>Itens</th>
                                    <th>Total (MZN)</th>
                                    <th>Forma Pag.</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="vendasBody">
                                <!-- Sales will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px;">
                        <div>
                            <span style="color: var(--bizzflow-gray); font-size: 0.9rem;">Mostrando <span id="saleCount">0</span> vendas</span>
                        </div>
                        <div>
                            <button class="btn btn-outline btn-sm" onclick="exportData('vendas', 'excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('vendas', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('vendas', 'csv')">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estatísticas de Vendas -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="vendasHojeCount">0</h3>
                            <p>Vendas Hoje</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="vendasSemanaCount">0</h3>
                            <p>Vendas Esta Semana</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #e67e22, #d35400);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="vendasMesCount">0</h3>
                            <p>Vendas Este Mês</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-money-bill-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="faturamentoMes">0 MZN</h3>
                            <p>Faturamento do Mês</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financeiro Page -->
            <div id="financeiroPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-money-bill-wave"></i> Gestão Financeira</h2>
                        <div>
                            <button class="btn btn-success btn-sm">
                                <i class="fas fa-plus"></i> Novo Recebimento
                            </button>
                            <button class="btn btn-danger btn-sm" style="margin-left: 10px;">
                                <i class="fas fa-minus"></i> Novo Pagamento
                            </button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-top: 20px;">
                        <div>
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Fluxo de Caixa</h3>
                            <canvas id="cashflowChart" height="300"></canvas>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Saldo Atual</h3>
                            <div style="background: linear-gradient(135deg, var(--bizzflow-primary), var(--bizzflow-secondary)); color: white; padding: 25px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 1.2rem; margin-bottom: 10px;">Saldo Disponível</div>
                                <div style="font-size: 2.5rem; font-weight: 700;" id="currentBalance">0 MZN</div>
                                <div style="font-size: 0.9rem; margin-top: 15px; opacity: 0.9;">Atualizado em tempo real</div>
                            </div>
                            
                            <div style="margin-top: 25px;">
                                <h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Resumo Financeiro</h4>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Receitas do Mês:</span>
                                    <span style="font-weight: 600; color: #27ae60;" id="monthlyIncome">0 MZN</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Despesas do Mês:</span>
                                    <span style="font-weight: 600; color: #e74c3c;" id="monthlyExpenses">0 MZN</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-top: 10px; border-top: 1px solid #eee;">
                                    <span>Lucro Líquido:</span>
                                    <span style="font-weight: 700; color: var(--bizzflow-primary);" id="monthlyProfit">0 MZN</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relatórios Page -->
            <div id="relatoriosPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-chart-bar"></i> Relatórios e Analytics</h2>
                        <div>
                            <select id="reportPeriod" class="form-control" style="width: auto; display: inline-block; margin-right: 10px;">
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este Mês</option>
                                <option value="quarter">Este Trimestre</option>
                                <option value="year">Este Ano</option>
                            </select>
                            <div class="export-buttons" style="display: inline-block;">
                                <button class="btn btn-outline btn-sm" onclick="exportReportData('excel')">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportReportData('pdf')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportReportData('csv')">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tabs" style="margin-top: 15px;">
                        <div class="tab active" data-report-tab="sales">Vendas</div>
                        <div class="tab" data-report-tab="products">Produtos</div>
                        <div class="tab" data-report-tab="clients">Clientes</div>
                        <div class="tab" data-report-tab="financial">Financeiro</div>
                        <div class="tab" data-report-tab="subscriptions">Assinaturas</div>
                        <div class="tab" data-report-tab="custom">Personalizado</div>
                    </div>
                    
                    <div id="salesReportTab" class="tab-content active" style="margin-top: 25px;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-bottom: 30px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Vendas por Dia</h3>
                                <canvas id="reportSalesChart" height="250"></canvas>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Top Produtos</h3>
                                <canvas id="reportProductsChart" height="250"></canvas>
                            </div>
                        </div>
                        
                        <div class="stats-cards">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <h3 id="reportTotalSales">0 MZN</h3>
                                    <p>Total de Vendas</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <h3 id="reportTotalItems">0</h3>
                                    <p>Itens Vendidos</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <h3 id="reportAvgSale">0 MZN</h3>
                                    <p>Venda Média</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <h3 id="reportTopProduct">-</h3>
                                    <p>Produto Mais Vendido</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="productsReportTab" class="tab-content" style="margin-top: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Produtos Mais Vendidos</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Produto</th>
                                            <th>Categoria</th>
                                            <th>Quantidade Vendida</th>
                                            <th>Receita Total</th>
                                            <th>Margem de Lucro</th>
                                        </tr>
                                    </thead>
                                    <tbody id="topProductsBody">
                                        <!-- Top products will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="clientsReportTab" class="tab-content" style="margin-top: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Top Clientes</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Cliente</th>
                                            <th>Tipo</th>
                                            <th>Total Compras</th>
                                            <th>Última Compra</th>
                                            <th>Ticket Médio</th>
                                        </tr>
                                    </thead>
                                    <tbody id="topClientsBody">
                                        <!-- Top clients will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="financialReportTab" class="tab-content" style="margin-top: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Relatório Financeiro</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Mês</th>
                                            <th>Receitas</th>
                                            <th>Despesas</th>
                                            <th>Lucro</th>
                                            <th>Margem</th>
                                            <th>Crescimento</th>
                                        </tr>
                                    </thead>
                                    <tbody id="financialReportBody">
                                        <!-- Financial data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="subscriptionsReportTab" class="tab-content" style="margin-top: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Relatório de Assinaturas</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Plano</th>
                                            <th>Assinaturas Ativas</th>
                                            <th>Receita Mensal</th>
                                            <th>Taxa de Retenção</th>
                                            <th>Churn Rate</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subscriptionsReportBody">
                                        <!-- Subscriptions data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div id="customReportTab" class="tab-content" style="margin-top: 25px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Relatório Personalizado</h3>
                            <div class="form-group">
                                <label for="reportType">Tipo de Relatório</label>
                                <select id="reportType" class="form-control">
                                    <option value="sales">Vendas</option>
                                    <option value="products">Produtos</option>
                                    <option value="clients">Clientes</option>
                                    <option value="financial">Financeiro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dateRange">Período</label>
                                <select id="dateRange" class="form-control">
                                    <option value="today">Hoje</option>
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mês</option>
                                    <option value="quarter">Este Trimestre</option>
                                    <option value="year">Este Ano</option>
                                    <option value="custom">Personalizado</option>
                                </select>
                            </div>
                            <div id="customDateRange" style="display: none;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label for="startDate">Data Inicial</label>
                                        <input type="date" id="startDate" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="endDate">Data Final</label>
                                        <input type="date" id="endDate" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="generateCustomReport()">
                                <i class="fas fa-chart-bar"></i> Gerar Relatório
                            </button>
                            <div id="customReportResults" style="margin-top: 20px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Investimentos Page (para Investidores) -->
            <div id="investimentosPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-chart-line"></i> Dashboard do Investidor</h2>
                        <div>
                            <select id="investmentPeriod" class="form-control" style="width: auto; display: inline-block;">
                                <option value="month">Último Mês</option>
                                <option value="quarter" selected>Último Trimestre</option>
                                <option value="year">Último Ano</option>
                                <option value="all">Todo Período</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Informação para Investidores:</strong> Esta secção apresenta métricas financeiras detalhadas, ROI, e projeções de crescimento do negócio.
                        </div>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stat-card" style="border-top-color: #9b59b6;">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="roiPercentage">0%</h3>
                                <p>ROI (Retorno sobre Investimento)</p>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>5.2% vs período anterior</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card" style="border-top-color: #3498db;">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="growthRate">0%</h3>
                                <p>Taxa de Crescimento</p>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>12.5% vs período anterior</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card" style="border-top-color: #2ecc71;">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalInvestment">0 MZN</h3>
                                <p>Total Investido</p>
                            </div>
                        </div>
                        <div class="stat-card" style="border-top-color: #e74c3c;">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="profitMargin">0%</h3>
                                <p>Margem de Lucro</p>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>2.3% vs período anterior</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-top: 30px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Performance do Investimento</h3>
                            <canvas id="investmentChart" height="300"></canvas>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Próximos Passos</h3>
                            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;">
                                <h4 style="color: var(--bizzflow-primary); margin-bottom: 10px;">Recomendações</h4>
                                <ul style="padding-left: 20px;">
                                    <li style="margin-bottom: 8px;">Aumentar investimento em marketing digital</li>
                                    <li style="margin-bottom: 8px;">Expandir para nova localização</li>
                                    <li style="margin-bottom: 8px;">Diversificar linha de produtos</li>
                                </ul>
                            </div>
                            
                            <div style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                                <h4 style="color: var(--bizzflow-primary); margin-bottom: 10px;">Relatórios Disponíveis</h4>
                                <button class="btn btn-outline btn-sm" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-file-pdf"></i> Relatório Financeiro Detalhado
                                </button>
                                <button class="btn btn-outline btn-sm" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-file-excel"></i> Projeções de Crescimento
                                </button>
                                <button class="btn btn-outline btn-sm" style="width: 100%;">
                                    <i class="fas fa-file-alt"></i> Análise de Mercado
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planos Page -->
            <div id="planosPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-crown"></i> Gestão de Planos</h2>
                        <button class="btn btn-primary" id="novoPlanoBtn">
                            <i class="fas fa-plus"></i> Novo Plano
                        </button>
                    </div>
                    
                    <div class="plans-grid" id="plansGrid">
                        <!-- Planos serão carregados aqui -->
                    </div>
                </div>
                
                <!-- Configurações de Período de Teste -->
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-clock"></i> Configurações de Período de Teste</h2>
                    </div>
                    
                    <form id="trialSettingsForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px;">
                            <div>
                                <div class="form-group">
                                    <label for="trialDays">Dias de Teste Gratuito</label>
                                    <input type="number" id="trialDays" class="form-control" min="0" max="365" value="7">
                                    <small style="color: var(--bizzflow-gray); font-size: 0.85rem;">Número de dias para o período de teste gratuito</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="trialFeatures">Funcionalidades Incluídas no Teste</label>
                                    <select id="trialFeatures" class="form-control" multiple style="height: 150px;">
                                        <option value="dashboard" selected>Dashboard</option>
                                        <option value="clientes" selected>Gestão de Clientes</option>
                                        <option value="produtos" selected>Gestão de Produtos</option>
                                        <option value="vendas" selected>Gestão de Vendas</option>
                                        <option value="relatorios" selected>Relatórios Básicos</option>
                                        <option value="exportar">Exportação de Dados</option>
                                        <option value="importar">Importação de Dados</option>
                                        <option value="suporte">Suporte por Email</option>
                                    </select>
                                    <small style="color: var(--bizzflow-gray); font-size: 0.85rem;">Mantenha CTRL para selecionar múltiplas opções</small>
                                </div>
                            </div>
                            
                            <div>
                                <div class="form-group">
                                    <label for="trialLimits">Limites do Período de Teste</label>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Máximo de Clientes:</span>
                                            <input type="number" id="trialMaxClients" class="form-control" style="width: 100px; display: inline-block;" min="1" max="1000" value="50">
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Máximo de Produtos:</span>
                                            <input type="number" id="trialMaxProducts" class="form-control" style="width: 100px; display: inline-block;" min="1" max="10000" value="100">
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>Máximo de Vendas/Mês:</span>
                                            <input type="number" id="trialMaxSales" class="form-control" style="width: 100px; display: inline-block;" min="1" max="10000" value="100">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="trialAutoCancel" checked> Cancelar automaticamente após o período de teste
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="trialNotifications" checked> Enviar notificações antes do fim do teste
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="trialCardRequired"> Exigir cartão de crédito para teste gratuito
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Configurações de Teste
                        </button>
                    </form>
                </div>
            </div>

            <!-- Assinaturas Page -->
            <div id="assinaturasPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-file-contract"></i> Gestão de Assinaturas</h2>
                        <button class="btn btn-primary" id="novaAssinaturaBtn">
                            <i class="fas fa-plus"></i> Nova Assinatura
                        </button>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-subscription-tab="active">Ativas</div>
                        <div class="tab" data-subscription-tab="trial">Em Teste</div>
                        <div class="tab" data-subscription-tab="pending">Pendentes</div>
                        <div class="tab" data-subscription-tab="expired">Expiradas</div>
                        <div class="tab" data-subscription-tab="cancelled">Canceladas</div>
                    </div>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table id="assinaturasTable">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Plano</th>
                                    <th>Início</th>
                                    <th>Fim</th>
                                    <th>Próximo Pagamento</th>
                                    <th>Valor (MZN)</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="assinaturasBody">
                                <!-- Assinaturas serão carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px;">
                        <div>
                            <span style="color: var(--bizzflow-gray); font-size: 0.9rem;">Mostrando <span id="subscriptionCount">0</span> assinaturas</span>
                        </div>
                        <div>
                            <button class="btn btn-outline btn-sm" onclick="exportData('assinaturas', 'excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('assinaturas', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportData('assinaturas', 'csv')">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estatísticas de Assinaturas -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalAssinaturas">0</h3>
                            <p>Total de Assinaturas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="assinaturasAtivas">0</h3>
                            <p>Assinaturas Ativas</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="assinaturasTrial">0</h3>
                            <p>Em Período de Teste</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="receitaMensal">0 MZN</h3>
                            <p>Receita Mensal Recorrente</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Importar/Exportar Page -->
            <div id="exportarPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-file-export"></i> Importar e Exportar Dados</h2>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-import-export-tab="export">Exportar</div>
                        <div class="tab" data-import-export-tab="import">Importar</div>
                        <div class="tab" data-import-export-tab="templates">Templates</div>
                    </div>
                    
                    <!-- Exportar -->
                    <div id="exportTab" class="tab-content active" style="margin-top: 25px;">
                        <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                            <i class="fas fa-download"></i> Exportar Dados do Sistema
                        </h3>
                        
                        <div class="import-export-box" onclick="showExportOptions()">
                            <i class="fas fa-cloud-download-alt" style="font-size: 3rem; color: var(--bizzflow-primary); margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Clique para Exportar Dados</h4>
                            <p style="color: var(--bizzflow-gray);">Exporte todos os seus dados em múltiplos formatos</p>
                        </div>
                        
                        <div id="exportOptions" style="display: none; margin-top: 20px;">
                            <h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Selecione o que deseja exportar:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; cursor: pointer;" onclick="exportData('all', 'excel')">
                                    <h5><i class="fas fa-file-excel" style="color: #217346;"></i> Tudo em Excel</h5>
                                    <p style="font-size: 0.9rem; color: var(--bizzflow-gray);">Todos os dados em uma pasta Excel</p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; cursor: pointer;" onclick="exportData('all', 'pdf')">
                                    <h5><i class="fas fa-file-pdf" style="color: #e74c3c;"></i> Relatório Completo PDF</h5>
                                    <p style="font-size: 0.9rem; color: var(--bizzflow-gray);">Relatório detalhado em PDF</p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; cursor: pointer;" onclick="exportData('all', 'csv')">
                                    <h5><i class="fas fa-file-csv" style="color: #3498db;"></i> Backup Completo CSV</h5>
                                    <p style="font-size: 0.9rem; color: var(--bizzflow-gray);">Todos os dados em formato CSV</p>
                                </div>
                            </div>
                            
                            <h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Ou exporte por categoria:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                <button class="btn btn-outline btn-sm" onclick="exportData('clientes', 'excel')">
                                    <i class="fas fa-users"></i> Clientes (Excel)
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportData('produtos', 'excel')">
                                    <i class="fas fa-box"></i> Produtos (Excel)
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportData('vendas', 'excel')">
                                    <i class="fas fa-shopping-cart"></i> Vendas (Excel)
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportData('fornecedores', 'excel')">
                                    <i class="fas fa-truck"></i> Fornecedores (Excel)
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportData('assinaturas', 'excel')">
                                    <i class="fas fa-file-contract"></i> Assinaturas (Excel)
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Importar -->
                    <div id="importTab" class="tab-content" style="margin-top: 25px;">
                        <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                            <i class="fas fa-upload"></i> Importar Dados para o Sistema
                        </h3>
                        
                        <div class="file-upload-area" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--bizzflow-secondary); margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Arraste e solte arquivos aqui</h4>
                            <p style="color: var(--bizzflow-gray); margin-bottom: 15px;">ou clique para selecionar arquivos</p>
                            <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" multiple style="display: none;">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open"></i> Selecionar Arquivos
                            </button>
                            <p style="color: var(--bizzflow-gray); font-size: 0.9rem; margin-top: 15px;">
                                Formatos suportados: CSV, Excel (.xlsx, .xls)
                            </p>
                        </div>
                        
                        <div id="importOptions" style="margin-top: 20px;">
                            <h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Selecione o tipo de importação:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                                    <h5><i class="fas fa-users" style="color: #3498db;"></i> Importar Clientes</h5>
                                    <p style="font-size: 0.9rem; color: var(--bizzflow-gray); margin-bottom: 10px;">Importe lista de clientes em massa</p>
                                    <button class="btn btn-outline btn-sm" onclick="showImportTemplate('clientes')">
                                        <i class="fas fa-download"></i> Template
                                    </button>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                                    <h5><i class="fas fa-box" style="color: #2ecc71;"></i> Importar Produtos</h5>
                                    <p style="font-size: 0.9rem; color: var(--bizzflow-gray); margin-bottom: 10px;">Importe catálogo de produtos</p>
                                    <button class="btn btn-outline btn-sm" onclick="showImportTemplate('produtos')">
                                        <i class="fas fa-download"></i> Template
                                    </button>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                                    <h5><i class="fas fa-shopping-cart" style="color: #9b59b6;"></i> Importar Vendas</h5>
                                    <p style="font-size: 0.9rem; color: var(--bizzflow-gray); margin-bottom: 10px;">Importe histórico de vendas</p>
                                    <button class="btn btn-outline btn-sm" onclick="showImportTemplate('vendas')">
                                        <i class="fas fa-download"></i> Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Templates -->
                    <div id="templatesTab" class="tab-content" style="margin-top: 25px;">
                        <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                            <i class="fas fa-file-alt"></i> Templates de Importação
                        </h3>
                        
                        <p style="margin-bottom: 20px; color: var(--bizzflow-gray);">
                            Baixe os templates para preparar os seus dados antes da importação.
                        </p>
                        
                        <div class="template-download">
                            <div class="template-info">
                                <h4>Template para Clientes</h4>
                                <p>Formato CSV com colunas: Nome, Telefone, Email, Endereço, NIF</p>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="downloadTemplate('clientes')">
                                <i class="fas fa-download"></i> Baixar Template
                            </button>
                        </div>
                        
                        <div class="template-download">
                            <div class="template-info">
                                <h4>Template para Produtos</h4>
                                <p>Formato CSV com colunas: Código, Nome, Categoria, Preço, Custo, Stock</p>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="downloadTemplate('produtos')">
                                <i class="fas fa-download"></i> Baixar Template
                            </button>
                        </div>
                        
                        <div class="template-download">
                            <div class="template-info">
                                <h4>Template para Vendas</h4>
                                <p>Formato CSV com colunas: Data, Cliente, Produtos, Total, Forma Pagamento</p>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="downloadTemplate('vendas')">
                                <i class="fas fa-download"></i> Baixar Template
                            </button>
                        </div>
                        
                        <div class="template-download">
                            <div class="template-info">
                                <h4>Template para Fornecedores</h4>
                                <p>Formato CSV com colunas: Nome, Contacto, Email, Produtos Fornecidos</p>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="downloadTemplate('fornecedores')">
                                <i class="fas fa-download"></i> Baixar Template
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stock Page -->
            <div id="stockPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-warehouse"></i> Gestão de Stock</h2>
                        <div>
                            <button class="btn btn-primary btn-sm" id="novaEntradaBtn">
                                <i class="fas fa-plus"></i> Nova Entrada
                            </button>
                            <button class="btn btn-warning btn-sm" style="margin-left: 10px;" id="novaSaidaBtn">
                                <i class="fas fa-minus"></i> Nova Saída
                            </button>
                            <button class="btn btn-success btn-sm" style="margin-left: 10px;" id="inventarioBtn">
                                <i class="fas fa-sync-alt"></i> Inventário
                            </button>
                            <div class="export-buttons" style="display: inline-block; margin-left: 10px;">
                                <button class="btn btn-outline btn-sm" onclick="exportStockData('excel')">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportStockData('pdf')">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportStockData('csv')">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px;">
                        <div>
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Movimentações Recentes</h3>
                            <div class="table-container">
                                <table style="min-width: auto;">
                                    <thead>
                                        <tr>
                                            <th>Data</th>
                                            <th>Produto</th>
                                            <th>Tipo</th>
                                            <th>Quantidade</th>
                                            <th>Responsável</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stockMovementsBody">
                                        <!-- Stock movements will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Avisos de Stock</h3>
                            <div id="stockWarningsList">
                                <!-- Stock warnings will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Relatório de Stock -->
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Relatório de Stock</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Produto</th>
                                        <th>Categoria</th>
                                        <th>Stock Atual</th>
                                        <th>Stock Mínimo</th>
                                        <th>Stock Máximo</th>
                                        <th>Valor em Stock</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="stockReportBody">
                                    <!-- Stock report will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fornecedores Page -->
            <div id="fornecedoresPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-truck"></i> Gestão de Fornecedores</h2>
                        <button class="btn btn-primary" id="novoFornecedorBtn">
                            <i class="fas fa-plus"></i> Novo Fornecedor
                        </button>
                    </div>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table id="fornecedoresTable">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Contacto</th>
                                    <th>Produtos Fornecidos</th>
                                    <th>Última Entrega</th>
                                    <th>Avaliação</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="fornecedoresBody">
                                <!-- Suppliers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Encomendas Page -->
            <div id="encomendasPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-clipboard-list"></i> Gestão de Encomendas</h2>
                        <button class="btn btn-primary" id="novaEncomendaBtn">
                            <i class="fas fa-plus"></i> Nova Encomenda
                        </button>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-order-tab="pending">Pendentes</div>
                        <div class="tab" data-order-tab="processing">Em Processo</div>
                        <div class="tab" data-order-tab="completed">Concluídas</div>
                        <div class="tab" data-order-tab="cancelled">Canceladas</div>
                    </div>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table id="encomendasTable">
                            <thead>
                                <tr>
                                    <th>Nº Encomenda</th>
                                    <th>Cliente</th>
                                    <th>Data</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Previsão Entrega</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="encomendasBody">
                                <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Equipa Page -->
            <div id="equipaPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-user-tie"></i> Gestão da Equipa</h2>
                        <button class="btn btn-primary" id="novoMembroBtn">
                            <i class="fas fa-plus"></i> Novo Membro
                        </button>
                    </div>
                    
                    <div class="stats-cards" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalMembros">0</h3>
                                <p>Total de Membros</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="membrosAtivos">0</h3>
                                <p>Membros Ativos</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="vendasEquipa">0</h3>
                                <p>Vendas da Equipa</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="topVendedor">-</h3>
                                <p>Top Vendedor</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="equipaTable">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Cargo</th>
                                    <th>Contacto</th>
                                    <th>Data Admissão</th>
                                    <th>Vendas</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="equipaBody">
                                <!-- Team members will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Configurações Page -->
            <div id="configuracoesPage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-cog"></i> Configurações do Sistema</h2>
                    </div>
                    
                    <div class="tabs" style="margin-top: 10px;">
                        <div class="tab active" data-settings-tab="business">Empresa</div>
                        <div class="tab" data-settings-tab="system">Sistema</div>
                        <div class="tab" data-settings-tab="users">Utilizadores</div>
                        <div class="tab" data-settings-tab="subscriptions">Assinaturas</div>
                        <div class="tab" data-settings-tab="integrations">Integrações</div>
                        <div class="tab" data-settings-tab="backup">Backup</div>
                    </div>
                    
                    <div id="businessSettingsTab" class="tab-content active" style="margin-top: 25px;">
                        <form id="businessSettingsForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                                <div>
                                    <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                                        <i class="fas fa-building"></i> Informação da Empresa
                                    </h3>
                                    <div class="form-group">
                                        <label for="companyName">Nome da Empresa</label>
                                        <input type="text" id="companyName" class="form-control" value="Bizz Flow Lda">
                                    </div>
                                    <div class="form-group">
                                        <label for="companyNIF">NIF</label>
                                        <input type="text" id="companyNIF" class="form-control" value="123456789">
                                    </div>
                                    <div class="form-group">
                                        <label for="companyAddress">Endereço</label>
                                        <input type="text" id="companyAddress" class="form-control" value="Av. 25 de Setembro, Maputo">
                                    </div>
                                    <div class="form-group">
                                        <label for="companyPhone">Telefone</label>
                                        <input type="text" id="companyPhone" class="form-control" value="+258 84 123 4567">
                                    </div>
                                    <div class="form-group">
                                        <label for="companyEmail">Email</label>
                                        <input type="email" id="companyEmail" class="form-control" value="info@bizzflow.co.mz">
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                                        <i class="fas fa-receipt"></i> Configurações de Faturação
                                    </h3>
                                    <div class="form-group">
                                        <label for="invoicePrefix">Prefixo da Fatura</label>
                                        <input type="text" id="invoicePrefix" class="form-control" value="FAT">
                                    </div>
                                    <div class="form-group">
                                        <label for="invoiceStartNumber">Número Inicial</label>
                                        <input type="number" id="invoiceStartNumber" class="form-control" value="1001">
                                    </div>
                                    <div class="form-group">
                                        <label for="invoiceFooter">Rodapé da Fatura</label>
                                        <textarea id="invoiceFooter" class="form-control" rows="3">Obrigado pela sua preferência!</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="autoPrintInvoice" checked> Imprimir fatura automaticamente
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Guardar Configurações
                            </button>
                        </form>
                    </div>
                    
                    <div id="subscriptionsSettingsTab" class="tab-content" style="margin-top: 25px;">
                        <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                            <i class="fas fa-crown"></i> Configurações de Assinaturas
                        </h3>
                        
                        <form id="subscriptionSettingsForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                                <div>
                                    <div class="form-group">
                                        <label for="subscriptionCurrency">Moeda para Assinaturas</label>
                                        <select id="subscriptionCurrency" class="form-control">
                                            <option value="MZN" selected>Metical (MZN)</option>
                                            <option value="USD">Dólar Americano (USD)</option>
                                            <option value="EUR">Euro (EUR)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="trialPeriodDays">Período de Teste Gratuito (dias)</label>
                                        <input type="number" id="trialPeriodDays" class="form-control" value="7" min="0" max="365">
                                        <small style="color: var(--bizzflow-gray); font-size: 0.85rem;">Defina 0 para desativar teste gratuito</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="gracePeriodDays">Período de Carência (dias)</label>
                                        <input type="number" id="gracePeriodDays" class="form-control" value="3" min="0" max="30">
                                        <small style="color: var(--bizzflow-gray); font-size: 0.85rem;">Dias após expiração antes do cancelamento</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="autoRenewal">Renovação Automática</label>
                                        <select id="autoRenewal" class="form-control">
                                            <option value="enabled" selected>Ativada</option>
                                            <option value="disabled">Desativada</option>
                                            <option value="opt-in">Opt-in (Cliente escolhe)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="form-group">
                                        <label for="paymentMethods">Métodos de Pagamento Disponíveis</label>
                                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                            <label style="display: block; margin-bottom: 8px;">
                                                <input type="checkbox" id="paymentMulticaixa" checked> Multicaixa
                                            </label>
                                            <label style="display: block; margin-bottom: 8px;">
                                                <input type="checkbox" id="paymentMPesa" checked> M-Pesa
                                            </label>
                                            <label style="display: block; margin-bottom: 8px;">
                                                <input type="checkbox" id="paymentEMola" checked> E-Mola
                                            </label>
                                            <label style="display: block; margin-bottom: 8px;">
                                                <input type="checkbox" id="paymentTransfer" checked> Transferência Bancária
                                            </label>
                                            <label style="display: block; margin-bottom: 8px;">
                                                <input type="checkbox" id="paymentCard"> Cartão de Crédito
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="invoiceDaysBefore">Fatura Antecipada (dias)</label>
                                        <input type="number" id="invoiceDaysBefore" class="form-control" value="7" min="1" max="30">
                                        <small style="color: var(--bizzflow-gray); font-size: 0.85rem;">Dias antes da renovação para enviar fatura</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="reminderDays">Lembretes (dias antes)</label>
                                        <input type="text" id="reminderDays" class="form-control" value="7,3,1">
                                        <small style="color: var(--bizzflow-gray); font-size: 0.85rem;">Dias separados por vírgula (ex: 7,3,1)</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                                <h4 style="margin-bottom: 15px; color: var(--bizzflow-primary);">Notificações de Assinatura</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 10px;">
                                            <input type="checkbox" id="notifyTrialEnd" checked> Notificar fim do período de teste
                                        </label>
                                        <label style="display: block; margin-bottom: 10px;">
                                            <input type="checkbox" id="notifyBeforeRenewal" checked> Notificar antes da renovação
                                        </label>
                                        <label style="display: block; margin-bottom: 10px;">
                                            <input type="checkbox" id="notifyPaymentFailed" checked> Notificar pagamento falhado
                                        </label>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 10px;">
                                            <input type="checkbox" id="notifySubscriptionEnd" checked> Notificar fim da assinatura
                                        </label>
                                        <label style="display: block; margin-bottom: 10px;">
                                            <input type="checkbox" id="notifyAutoRenewal" checked> Notificar renovação automática
                                        </label>
                                        <label style="display: block; margin-bottom: 10px;">
                                            <input type="checkbox" id="sendWelcomeEmail" checked> Enviar email de boas-vindas
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="margin-top: 25px;">
                                <i class="fas fa-save"></i> Guardar Configurações de Assinatura
                            </button>
                        </form>
                    </div>
                    
                    <div id="systemSettingsTab" class="tab-content" style="margin-top: 25px;">
                        <form id="systemSettingsForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                                <div>
                                    <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                                        <i class="fas fa-sliders-h"></i> Configurações Gerais
                                    </h3>
                                    <div class="form-group">
                                        <label for="currency">Moeda</label>
                                        <select id="currency" class="form-control">
                                            <option value="MZN" selected>Metical (MZN)</option>
                                            <option value="USD">Dólar Americano (USD)</option>
                                            <option value="EUR">Euro (EUR)</option>
                                            <option value="ZAR">Rand Sul-Africano (ZAR)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="taxRate">IVA (%)</label>
                                        <input type="number" id="taxRate" class="form-control" value="17" min="0" max="100" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="lowStockThreshold">Stock Mínimo Padrão</label>
                                        <input type="number" id="lowStockThreshold" class="form-control" value="10" min="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="timezone">Fuso Horário</label>
                                        <select id="timezone" class="form-control">
                                            <option value="Africa/Maputo" selected>Maputo, Moçambique</option>
                                            <option value="UTC">UTC</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">
                                        <i class="fas fa-bell"></i> Notificações e Alertas
                                    </h3>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="enableStockAlerts" checked> Alertas de stock baixo
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="enableSalesReports" checked> Relatórios de vendas diários
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="enableClientBirthdayAlerts" checked> Alertas de aniversário de clientes
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="enableAutoBackup" checked> Backup automático
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="backupFrequency">Frequência de Backup</label>
                                        <select id="backupFrequency" class="form-control">
                                            <option value="daily">Diariamente</option>
                                            <option value="weekly" selected>Semanalmente</option>
                                            <option value="monthly">Mensalmente</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Guardar Configurações
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Suporte Page -->
            <div id="suportePage" class="page-content" style="display: none;">
                <div class="content-box">
                    <div class="content-header">
                        <h2><i class="fas fa-headset"></i> Suporte e Ajuda</h2>
                    </div>
                    
                    <div class="feature-cards">
                        <div class="feature-card">
                            <i class="fas fa-question-circle"></i>
                            <h3>Central de Ajuda</h3>
                            <p>Aceda à nossa base de conhecimento com tutoriais, FAQs e guias passo-a-passo.</p>
                            <button class="btn btn-primary btn-sm" style="margin-top: 15px;">
                                <i class="fas fa-book-open"></i> Aceder Central
                            </button>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-comments"></i>
                            <h3>Suporte ao Vivo</h3>
                            <p>Converse em tempo real com a nossa equipa de suporte técnico especializado.</p>
                            <button class="btn btn-primary btn-sm" style="margin-top: 15px;">
                                <i class="fas fa-comment-dots"></i> Iniciar Chat
                            </button>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-phone-alt"></i>
                            <h3>Contactos</h3>
                            <p>Ligue para nós ou envie um email. Estamos disponíveis 24/7 para ajudar.</p>
                            <button class="btn btn-primary btn-sm" style="margin-top: 15px;">
                                <i class="fas fa-phone"></i> Contactar
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 20px; color: var(--bizzflow-primary);">Contactos de Suporte</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h4 style="color: var(--bizzflow-primary); margin-bottom: 10px;"><i class="fas fa-phone"></i> Telefone</h4>
                                <p>+258 84 123 4567</p>
                                <p style="font-size: 0.9rem; color: var(--bizzflow-gray);">Disponível 24/7</p>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h4 style="color: var(--bizzflow-primary); margin-bottom: 10px;"><i class="fas fa-envelope"></i> Email</h4>
                                <p>suporte@bizzflow.co.mz</p>
                                <p style="font-size: 0.9rem; color: var(--bizzflow-gray);">Resposta em até 2 horas</p>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                <h4 style="color: var(--bizzflow-primary); margin-bottom: 10px;"><i class="fas fa-map-marker-alt"></i> Endereço</h4>
                                <p>Av. 25 de Setembro, Maputo</p>
                                <p style="font-size: 0.9rem; color: var(--bizzflow-gray);">Moçambique</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAIS -->

    <!-- Modal Adicionar Cliente -->
    <div id="addClientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Novo Cliente</h2>
                <button class="modal-close" onclick="closeModal('addClientModal')">&times;</button>
            </div>
            <form id="addClientForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="form-group">
                            <label for="clientName">Nome Completo *</label>
                            <input type="text" id="clientName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Telefone *</label>
                            <input type="tel" id="clientPhone" class="form-control" required placeholder="+258 84 123 4567">
                        </div>
                        <div class="form-group">
                            <label for="clientEmail">Email</label>
                            <input type="email" id="clientEmail" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="clientNIF">NIF</label>
                            <input type="text" id="clientNIF" class="form-control">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="clientAddress">Endereço</label>
                            <textarea id="clientAddress" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="clientType">Tipo de Cliente</label>
                            <select id="clientType" class="form-control">
                                <option value="regular">Regular</option>
                                <option value="vip">VIP</option>
                                <option value="corporate">Corporativo</option>
                                <option value="wholesale">Atacado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="clientNotes">Observações</label>
                            <textarea id="clientNotes" class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('addClientModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Guardar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Adicionar Produto -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-box-plus"></i> Novo Produto</h2>
                <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <form id="addProductForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="form-group">
                            <label for="productCode">Código do Produto *</label>
                            <input type="text" id="productCode" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="productName">Nome do Produto *</label>
                            <input type="text" id="productName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="productCategory">Categoria</label>
                            <select id="productCategory" class="form-control">
                                <option value="Geral">Geral</option>
                                <option value="Alimentação">Alimentação</option>
                                <option value="Bebidas">Bebidas</option>
                                <option value="Limpeza">Limpeza</option>
                                <option value="Electrónica">Electrónica</option>
                                <option value="Roupa">Roupa</option>
                                <option value="Farmácia">Farmácia</option>
                                <option value="Construção">Construção</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Preço de Venda (MZN) *</label>
                            <input type="number" id="productPrice" class="form-control" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="productCost">Custo (MZN)</label>
                            <input type="number" id="productCost" class="form-control" min="0" step="0.01">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="productStock">Stock Inicial</label>
                            <input type="number" id="productStock" class="form-control" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="productMinStock">Stock Mínimo</label>
                            <input type="number" id="productMinStock" class="form-control" min="0" value="10">
                        </div>
                        <div class="form-group">
                            <label for="productSupplier">Fornecedor</label>
                            <select id="productSupplier" class="form-control">
                                <option value="">Selecionar Fornecedor</option>
                                <!-- Suppliers will be loaded here -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productBarcode">Código de Barras</label>
                            <input type="text" id="productBarcode" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="productDescription">Descrição</label>
                            <textarea id="productDescription" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('addProductModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Guardar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nova Venda -->
    <div id="newSaleModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-cash-register"></i> Nova Venda</h2>
                <button class="modal-close" onclick="closeModal('newSaleModal')">&times;</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px;">
                <!-- Coluna Esquerda: Produtos e Itens -->
                <div>
                    <div class="form-group">
                        <label for="saleSearchProduct">Buscar Produto</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="saleSearchProduct" class="form-control" placeholder="Digite o nome, código ou código de barras do produto">
                            <button type="button" class="btn btn-outline" id="scanBarcodeBtn">
                                <i class="fas fa-barcode"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="border: 1px solid #eaeaea; border-radius: 10px; padding: 15px; margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                        <h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Produtos Disponíveis</h4>
                        <div id="availableProductsList">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                    
                    <div style="border: 1px solid #eaeaea; border-radius: 10px; padding: 15px;">
                        <h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Itens da Venda</h4>
                        <div class="table-container">
                            <table style="min-width: auto;">
                                <thead>
                                    <tr>
                                        <th>Produto</th>
                                        <th>Qtd</th>
                                        <th>Preço Unit.</th>
                                        <th>Total</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="saleItemsList">
                                    <!-- Sale items will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Coluna Direita: Resumo da Venda -->
                <div>
                    <div class="form-group">
                        <label for="saleClient">Cliente (Opcional)</label>
                        <select id="saleClient" class="form-control">
                            <option value="">Cliente Avulso</option>
                            <!-- Clients will be loaded here -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="salePaymentMethod">Forma de Pagamento</label>
                        <select id="salePaymentMethod" class="form-control">
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Multicaixa">Multicaixa</option>
                            <option value="Transferência">Transferência</option>
                            <option value="M-Pesa">M-Pesa</option>
                            <option value="E-Mola">E-Mola</option>
                            <option value="Crédito">Crédito</option>
                        </select>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Subtotal:</span>
                            <span id="saleSubtotal">0.00 MZN</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Desconto:</span>
                            <span id="saleDiscount">0.00 MZN</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>IVA (17%):</span>
                            <span id="saleTax">0.00 MZN</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 1.3rem; font-weight: bold; padding-top: 10px; border-top: 1px solid #ddd;">
                            <span>Total:</span>
                            <span id="saleTotal">0.00 MZN</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="saleAmountReceived">Valor Recebido (MZN)</label>
                        <input type="number" id="saleAmountReceived" class="form-control" min="0" step="0.01" value="0">
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 1.1rem;">
                        <span>Troco:</span>
                        <span id="saleChange" style="font-weight: bold; color: #27ae60;">0.00 MZN</span>
                    </div>
                    
                    <button class="btn btn-success btn-lg" style="width: 100%; padding: 15px; font-size: 1.1rem;" id="completeSaleBtn">
                        <i class="fas fa-check-circle"></i> Finalizar Venda
                    </button>
                    <button class="btn btn-danger" style="width: 100%; margin-top: 10px;" onclick="closeModal('newSaleModal')">
                        <i class="fas fa-times"></i> Cancelar Venda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Detalhes da Venda -->
    <div id="viewSaleModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-receipt"></i> Detalhes da Venda</h2>
                <button class="modal-close" onclick="closeModal('viewSaleModal')">&times;</button>
            </div>
            <div id="saleDetailsContent">
                <!-- Detalhes da venda serão carregados aqui -->
            </div>
        </div>
    </div>

    <!-- Modal Novo Plano -->
    <div id="newPlanModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-crown"></i> Novo Plano de Assinatura</h2>
                <button class="modal-close" onclick="closeModal('newPlanModal')">&times;</button>
            </div>
            <form id="newPlanForm">
                <div class="form-group">
                    <label for="planName">Nome do Plano *</label>
                    <input type="text" id="planName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="planDescription">Descrição</label>
                    <textarea id="planDescription" class="form-control" rows="3"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="planPrice">Preço Mensal (MZN) *</label>
                        <input type="number" id="planPrice" class="form-control" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="planBillingCycle">Ciclo de Faturação</label>
                        <select id="planBillingCycle" class="form-control">
                            <option value="monthly">Mensal</option>
                            <option value="quarterly">Trimestral</option>
                            <option value="semiannual">Semestral</option>
                            <option value="annual">Anual</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Funcionalidades Incluídas</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureDashboard" checked> Dashboard
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureClients"> Gestão de Clientes
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureProducts"> Gestão de Produtos
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureSales"> Gestão de Vendas
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureReports"> Relatórios Avançados
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureExport"> Exportação de Dados
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureImport"> Importação de Dados
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="featureSupport"> Suporte Prioritário
                        </label>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="planMaxClients">Máximo de Clientes</label>
                        <input type="number" id="planMaxClients" class="form-control" min="1" value="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="planMaxProducts">Máximo de Produtos</label>
                        <input type="number" id="planMaxProducts" class="form-control" min="1" value="500">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="planStatus">Status do Plano</label>
                    <select id="planStatus" class="form-control">
                        <option value="active">Ativo</option>
                        <option value="inactive">Inativo</option>
                        <option value="archived">Arquivado</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('newPlanModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Criar Plano</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nova Assinatura -->
    <div id="newSubscriptionModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-file-contract"></i> Nova Assinatura</h2>
                <button class="modal-close" onclick="closeModal('newSubscriptionModal')">&times;</button>
            </div>
            <form id="newSubscriptionForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="form-group">
                            <label for="subscriptionClient">Cliente *</label>
                            <select id="subscriptionClient" class="form-control" required>
                                <option value="">Selecionar Cliente</option>
                                <!-- Clients will be loaded here -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriptionPlan">Plano *</label>
                            <select id="subscriptionPlan" class="form-control" required>
                                <option value="">Selecionar Plano</option>
                                <!-- Plans will be loaded here -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriptionStartDate">Data de Início *</label>
                            <input type="date" id="subscriptionStartDate" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriptionTrialDays">Dias de Teste Gratuito</label>
                            <input type="number" id="subscriptionTrialDays" class="form-control" min="0" max="365" value="7">
                        </div>
                    </div>
                    
                    <div>
                        <div class="form-group">
                            <label for="subscriptionPaymentMethod">Forma de Pagamento *</label>
                            <select id="subscriptionPaymentMethod" class="form-control" required>
                                <option value="Multicaixa">Multicaixa</option>
                                <option value="M-Pesa">M-Pesa</option>
                                <option value="E-Mola">E-Mola</option>
                                <option value="Transferência">Transferência Bancária</option>
                                <option value="Cartão">Cartão de Crédito</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriptionStatus">Status</label>
                            <select id="subscriptionStatus" class="form-control">
                                <option value="active">Ativa</option>
                                <option value="trial">Período de Teste</option>
                                <option value="pending">Pendente</option>
                                <option value="cancelled">Cancelada</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="subscriptionNotes">Observações</label>
                            <textarea id="subscriptionNotes" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="subscriptionAutoRenew" checked> Renovação Automática
                            </label>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('newSubscriptionModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Criar Assinatura</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Notificações -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2><i class="fas fa-bell"></i> Notificações</h2>
                <button class="modal-close" onclick="closeModal('notificationsModal')">&times;</button>
            </div>
            <div id="notificationsList">
                <div style="padding: 15px; border-bottom: 1px solid #f0f0f0;">
                    <div style="font-weight: 600; margin-bottom: 5px;">Stock Baixo</div>
                    <div style="font-size: 0.9rem; color: var(--bizzflow-gray);">Produto "Arroz 5kg" está com stock baixo</div>
                    <div style="font-size: 0.8rem; color: var(--bizzflow-gray); margin-top: 5px;">Há 2 horas</div>
                </div>
                <div style="padding: 15px; border-bottom: 1px solid #f0f0f0;">
                    <div style="font-weight: 600; margin-bottom: 5px;">Nova Venda</div>
                    <div style="font-size: 0.9rem; color: var(--bizzflow-gray);">Venda realizada no valor de 1.200 MZN</div>
                    <div style="font-size: 0.8rem; color: var(--bizzflow-gray); margin-top: 5px;">Hoje, 10:30</div>
                </div>
                <div style="padding: 15px;">
                    <div style="font-weight: 600; margin-bottom: 5px;">Backup Concluído</div>
                    <div style="font-size: 0.9rem; color: var(--bizzflow-gray);">Backup automático realizado com sucesso</div>
                    <div style="font-size: 0.8rem; color: var(--bizzflow-gray); margin-top: 5px;">Ontem, 23:00</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-outline btn-sm" onclick="closeModal('notificationsModal')">
                    <i class="fas fa-check"></i> Marcar Todas como Lidas
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Entrada de Stock -->
    <div id="stockEntryModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Nova Entrada de Stock</h2>
                <button class="modal-close" onclick="closeModal('stockEntryModal')">&times;</button>
            </div>
            <form id="stockEntryForm">
                <div class="form-group">
                    <label for="stockEntryProduct">Produto *</label>
                    <select id="stockEntryProduct" class="form-control" required>
                        <option value="">Selecionar Produto</option>
                        <!-- Products will be loaded here -->
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="stockEntryQuantity">Quantidade *</label>
                        <input type="number" id="stockEntryQuantity" class="form-control" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="stockEntryUnitCost">Custo Unitário (MZN)</label>
                        <input type="number" id="stockEntryUnitCost" class="form-control" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="stockEntrySupplier">Fornecedor</label>
                    <select id="stockEntrySupplier" class="form-control">
                        <option value="">Selecionar Fornecedor</option>
                        <!-- Suppliers will be loaded here -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="stockEntryNotes">Observações</label>
                    <textarea id="stockEntryNotes" class="form-control" rows="3"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('stockEntryModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Registar Entrada</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Saída de Stock -->
    <div id="stockOutputModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-minus-circle"></i> Nova Saída de Stock</h2>
                <button class="modal-close" onclick="closeModal('stockOutputModal')">&times;</button>
            </div>
            <form id="stockOutputForm">
                <div class="form-group">
                    <label for="stockOutputProduct">Produto *</label>
                    <select id="stockOutputProduct" class="form-control" required>
                        <option value="">Selecionar Produto</option>
                        <!-- Products will be loaded here -->
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="stockOutputQuantity">Quantidade *</label>
                        <input type="number" id="stockOutputQuantity" class="form-control" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="stockOutputReason">Motivo *</label>
                        <select id="stockOutputReason" class="form-control" required>
                            <option value="venda">Venda</option>
                            <option value="devolucao">Devolução</option>
                            <option value="dano">Produto Danificado</option>
                            <option value="perda">Perda</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="stockOutputClient">Cliente (para vendas)</label>
                    <select id="stockOutputClient" class="form-control">
                        <option value="">Selecionar Cliente</option>
                        <!-- Clients will be loaded here -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="stockOutputNotes">Observações</label>
                    <textarea id="stockOutputNotes" class="form-control" rows="3"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeModal('stockOutputModal')">Cancelar</button>
                    <button type="submit" class="btn btn-success">Registar Saída</button>
                </div>
            </form>
        </div>
    </div>
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        // Inicializar localStorage com dados de exemplo se estiver vazio
        function initializeData() {
            if (!localStorage.getItem('bizzflow_initialized')) {
                const sampleData = {
                    clients: [
                        {
                            id: 1,
                            name: "João Maputo",
                            phone: "+258 84 111 2222",
                            email: "joao@email.com",
                            nif: "100000001",
                            address: "Maputo",
                            type: "vip",
                            notes: "Cliente regular, compra todas as semanas",
                            total_purchases: 12500,
                            last_purchase: "2024-01-20",
                            created_at: "2024-01-15"
                        },
                        {
                            id: 2,
                            name: "Maria Matola",
                            phone: "+258 85 222 3333",
                            email: "maria@email.com",
                            nif: "100000002",
                            address: "Matola",
                            type: "regular",
                            notes: "",
                            total_purchases: 8500,
                            last_purchase: "2024-01-18",
                            created_at: "2024-01-20"
                        },
                        {
                            id: 3,
                            name: "Empresa Construção Lda",
                            phone: "+258 86 333 4444",
                            email: "construcao@empresa.com",
                            nif: "100000003",
                            address: "Beira",
                            type: "corporate",
                            notes: "Cliente corporativo, paga a 30 dias",
                            total_purchases: 45000,
                            last_purchase: "2024-01-15",
                            created_at: "2023-12-10"
                        }
                    ],
                    products: [
                        {
                            id: 1,
                            code: "PROD001",
                            name: "Arroz 5kg",
                            category: "Alimentação",
                            price: 350,
                            cost: 280,
                            stock: 45,
                            min_stock: 10,
                            barcode: "123456789012",
                            supplier: "Fornecedor A",
                            description: "Arroz branco de alta qualidade"
                        },
                        {
                            id: 2,
                            code: "PROD002",
                            name: "Feijão 1kg",
                            category: "Alimentação",
                            price: 120,
                            cost: 90,
                            stock: 28,
                            min_stock: 15,
                            barcode: "123456789013",
                            supplier: "Fornecedor A",
                            description: "Feijão vermelho"
                        },
                        {
                            id: 3,
                            code: "PROD003",
                            name: "Óleo 1L",
                            category: "Alimentação",
                            price: 150,
                            cost: 110,
                            stock: 32,
                            min_stock: 10,
                            barcode: "123456789014",
                            supplier: "Fornecedor B",
                            description: "Óleo vegetal"
                        },
                        {
                            id: 4,
                            code: "PROD004",
                            name: "Sabão em Pó",
                            category: "Limpeza",
                            price: 85,
                            cost: 60,
                            stock: 8,
                            min_stock: 10,
                            barcode: "123456789015",
                            supplier: "Fornecedor C",
                            description: "Sabão para roupa"
                        },
                        {
                            id: 5,
                            code: "PROD005",
                            name: "Detergente 500ml",
                            category: "Limpeza",
                            price: 65,
                            cost: 45,
                            stock: 42,
                            min_stock: 15,
                            barcode: "123456789016",
                            supplier: "Fornecedor C",
                            description: "Detergente líquido"
                        }
                    ],
                    sales: [
                        {
                            id: 1,
                            receipt_no: "REC001",
                            client_id: 1,
                            client_name: "João Maputo",
                            items: [
                                {product_id: 1, name: "Arroz 5kg", quantity: 2, price: 350, total: 700},
                                {product_id: 3, name: "Óleo 1L", quantity: 1, price: 150, total: 150}
                            ],
                            subtotal: 850,
                            discount: 0,
                            tax: 144.5,
                            total: 994.5,
                            payment_method: "Multicaixa",
                            amount_received: 1000,
                            change: 5.5,
                            date: new Date().toISOString().split('T')[0],
                            time: "14:30",
                            seller: "Administrador"
                        },
                        {
                            id: 2,
                            receipt_no: "REC002",
                            client_id: 2,
                            client_name: "Maria Matola",
                            items: [
                                {product_id: 2, name: "Feijão 1kg", quantity: 3, price: 120, total: 360},
                                {product_id: 4, name: "Sabão em Pó", quantity: 2, price: 85, total: 170},
                                {product_id: 5, name: "Detergente 500ml", quantity: 1, price: 65, total: 65}
                            ],
                            subtotal: 595,
                            discount: 20,
                            tax: 97.75,
                            total: 672.75,
                            payment_method: "Dinheiro",
                            amount_received: 700,
                            change: 27.25,
                            date: new Date().toISOString().split('T')[0],
                            time: "10:15",
                            seller: "Administrador"
                        }
                    ],
                    suppliers: [
                        {
                            id: 1,
                            name: "Fornecedor A",
                            contact: "+258 84 111 9999",
                            email: "fornecedorA@email.com",
                            products: ["Arroz", "Feijão", "Açúcar"],
                            last_delivery: "2024-01-18",
                            rating: 4.5
                        },
                        {
                            id: 2,
                            name: "Fornecedor B",
                            contact: "+258 85 222 8888",
                            email: "fornecedorB@email.com",
                            products: ["Óleo", "Margarina"],
                            last_delivery: "2024-01-20",
                            rating: 4.2
                        }
                    ],
                    team: [
                        {
                            id: 1,
                            name: "Administrador",
                            role: "Super Admin",
                            contact: "+258 84 123 4567",
                            email: "admin@bizzflow.co.mz",
                            join_date: "2024-01-01",
                            sales: 12450,
                            status: "active"
                        },
                        {
                            id: 2,
                            name: "Carlos Vendedor",
                            role: "Vendedor",
                            contact: "+258 85 234 5678",
                            email: "carlos@bizzflow.co.mz",
                            join_date: "2024-01-10",
                            sales: 8450,
                            status: "active"
                        }
                    ],
                    plans: [
                        {
                            id: 1,
                            name: "Plano Básico",
                            description: "Ideal para pequenas empresas e startups",
                            price: 499.99,
                            billing_cycle: "monthly",
                            features: ["dashboard", "clientes", "produtos", "vendas", "relatorios_basicos"],
                            max_clients: 50,
                            max_products: 100,
                            status: "active",
                            trial_days: 7,
                            is_popular: false
                        },
                        {
                            id: 2,
                            name: "Plano Profissional",
                            description: "Para empresas em crescimento com múltiplas necessidades",
                            price: 999.99,
                            billing_cycle: "monthly",
                            features: ["dashboard", "clientes", "produtos", "vendas", "relatorios_avancados", "exportar", "importar"],
                            max_clients: 200,
                            max_products: 500,
                            status: "active",
                            trial_days: 7,
                            is_popular: true
                        },
                        {
                            id: 3,
                            name: "Plano Empresarial",
                            description: "Solução completa para grandes empresas",
                            price: 1999.99,
                            billing_cycle: "monthly",
                            features: ["dashboard", "clientes", "produtos", "vendas", "relatorios_avancados", "exportar", "importar", "suporte_prioritario", "api_access"],
                            max_clients: 1000,
                            max_products: 5000,
                            status: "active",
                            trial_days: 14,
                            is_popular: false
                        }
                    ],
                    subscriptions: [
                        {
                            id: 1,
                            client_id: 1,
                            client_name: "João Maputo",
                            plan_id: 2,
                            plan_name: "Plano Profissional",
                            start_date: "2024-01-15",
                            end_date: "2024-02-14",
                            next_payment: "2024-02-14",
                            price: 999.99,
                            status: "active",
                            payment_method: "Multicaixa",
                            trial_end: "2024-01-22",
                            auto_renew: true,
                            notes: "Cliente satisfeito com o sistema"
                        },
                        {
                            id: 2,
                            client_id: 3,
                            client_name: "Empresa Construção Lda",
                            plan_id: 3,
                            plan_name: "Plano Empresarial",
                            start_date: "2024-01-10",
                            end_date: "2024-02-09",
                            next_payment: "2024-02-09",
                            price: 1999.99,
                            status: "trial",
                            payment_method: "Transferência",
                            trial_end: "2024-01-24",
                            auto_renew: true,
                            notes: "Em período de teste"
                        }
                    ],
                    settings: {
                        company_name: "Bizz Flow Lda",
                        company_nif: "123456789",
                        company_address: "Av. 25 de Setembro, Maputo",
                        company_phone: "+258 84 123 4567",
                        company_email: "info@bizzflow.co.mz",
                        currency: "MZN",
                        tax_rate: 17,
                        low_stock_threshold: 10,
                        enable_stock_alerts: true,
                        enable_sales_reports: true,
                        auto_print_invoice: true,
                        invoice_prefix: "FAT",
                        invoice_start_number: 1001,
                        timezone: "Africa/Maputo",
                        trial_days: 7,
                        trial_features: ["dashboard", "clientes", "produtos", "vendas", "relatorios_basicos"],
                        trial_max_clients: 50,
                        trial_max_products: 100,
                        trial_max_sales: 100,
                        trial_auto_cancel: true,
                        trial_notifications: true,
                        trial_card_required: false
                    },
                    subscription_settings: {
                        currency: "MZN",
                        trial_period_days: 7,
                        grace_period_days: 3,
                        auto_renewal: "enabled",
                        payment_methods: ["Multicaixa", "M-Pesa", "E-Mola", "Transferência"],
                        invoice_days_before: 7,
                        reminder_days: [7, 3, 1],
                        notify_trial_end: true,
                        notify_before_renewal: true,
                        notify_payment_failed: true,
                        notify_subscription_end: true,
                        notify_auto_renewal: true,
                        send_welcome_email: true
                    },
                    financial: {
                        current_balance: 25000,
                        monthly_income: 50000,
                        monthly_expenses: 25000,
                        monthly_profit: 25000
                    },
                    investments: {
                        total_invested: 100000,
                        roi_percentage: 25,
                        growth_rate: 12.5,
                        profit_margin: 20
                    },
                    stock_movements: [
                        {
                            id: 1,
                            product_id: 1,
                            product_name: "Arroz 5kg",
                            type: "entrada",
                            quantity: 50,
                            unit_cost: 280,
                            total_cost: 14000,
                            supplier_id: 1,
                            supplier_name: "Fornecedor A",
                            date: "2024-01-15",
                            responsible: "Administrador",
                            notes: "Compra mensal"
                        },
                        {
                            id: 2,
                            product_id: 1,
                            product_name: "Arroz 5kg",
                            type: "saida",
                            quantity: 2,
                            reason: "venda",
                            client_id: 1,
                            client_name: "João Maputo",
                            date: new Date().toISOString().split('T')[0],
                            responsible: "Administrador",
                            notes: "Venda REC001"
                        }
                    ]
                };
                
                localStorage.setItem('bizzflow_clients', JSON.stringify(sampleData.clients));
                localStorage.setItem('bizzflow_products', JSON.stringify(sampleData.products));
                localStorage.setItem('bizzflow_sales', JSON.stringify(sampleData.sales));
                localStorage.setItem('bizzflow_suppliers', JSON.stringify(sampleData.suppliers));
                localStorage.setItem('bizzflow_team', JSON.stringify(sampleData.team));
                localStorage.setItem('bizzflow_plans', JSON.stringify(sampleData.plans));
                localStorage.setItem('bizzflow_subscriptions', JSON.stringify(sampleData.subscriptions));
                localStorage.setItem('bizzflow_settings', JSON.stringify(sampleData.settings));
                localStorage.setItem('bizzflow_subscription_settings', JSON.stringify(sampleData.subscription_settings));
                localStorage.setItem('bizzflow_financial', JSON.stringify(sampleData.financial));
                localStorage.setItem('bizzflow_investments', JSON.stringify(sampleData.investments));
                localStorage.setItem('bizzflow_next_ids', JSON.stringify(sampleData.next_ids));
                localStorage.setItem('bizzflow_stock_movements', JSON.stringify(sampleData.stock_movements));
                localStorage.setItem('bizzflow_initialized', 'true');
            }
        }

        // Funções de Gestão de Dados
        function getClients() {
            return JSON.parse(localStorage.getItem('bizzflow_clients') || '[]');
        }

        function getProducts() {
            return JSON.parse(localStorage.getItem('bizzflow_products') || '[]');
        }

        function getSales() {
            return JSON.parse(localStorage.getItem('bizzflow_sales') || '[]');
        }

        function getSuppliers() {
            return JSON.parse(localStorage.getItem('bizzflow_suppliers') || '[]');
        }

        function getTeam() {
            return JSON.parse(localStorage.getItem('bizzflow_team') || '[]');
        }

        function getPlans() {
            return JSON.parse(localStorage.getItem('bizzflow_plans') || '[]');
        }

        function getSubscriptions() {
            return JSON.parse(localStorage.getItem('bizzflow_subscriptions') || '[]');
        }

        function getSettings() {
            return JSON.parse(localStorage.getItem('bizzflow_settings') || '{}');
        }

        function getSubscriptionSettings() {
            return JSON.parse(localStorage.getItem('bizzflow_subscription_settings') || '{}');
        }

        function getFinancial() {
            return JSON.parse(localStorage.getItem('bizzflow_financial') || '{}');
        }

        function getInvestments() {
            return JSON.parse(localStorage.getItem('bizzflow_investments') || '{}');
        }

        function getStockMovements() {
            return JSON.parse(localStorage.getItem('bizzflow_stock_movements') || '[]');
        }

        function getNextId(type) {
            const nextIds = JSON.parse(localStorage.getItem('bizzflow_next_ids') || '{"client": 1, "product": 1, "sale": 1, "supplier": 1, "team": 1, "plan": 1, "subscription": 1, "stock_movement": 1}');
            return nextIds[type] || 1;
        }

        function saveNextId(type, id) {
            const nextIds = JSON.parse(localStorage.getItem('bizzflow_next_ids') || '{"client": 1, "product": 1, "sale": 1, "supplier": 1, "team": 1, "plan": 1, "subscription": 1, "stock_movement": 1}');
            nextIds[type] = id;
            localStorage.setItem('bizzflow_next_ids', JSON.stringify(nextIds));
        }

        function saveClients(clients) {
            localStorage.setItem('bizzflow_clients', JSON.stringify(clients));
        }

        function saveProducts(products) {
            localStorage.setItem('bizzflow_products', JSON.stringify(products));
        }

        function saveSales(sales) {
            localStorage.setItem('bizzflow_sales', JSON.stringify(sales));
        }

        function saveSuppliers(suppliers) {
            localStorage.setItem('bizzflow_suppliers', JSON.stringify(suppliers));
        }

        function saveTeam(team) {
            localStorage.setItem('bizzflow_team', JSON.stringify(team));
        }

        function savePlans(plans) {
            localStorage.setItem('bizzflow_plans', JSON.stringify(plans));
        }

        function saveSubscriptions(subscriptions) {
            localStorage.setItem('bizzflow_subscriptions', JSON.stringify(subscriptions));
        }

        function saveSettings(settings) {
            localStorage.setItem('bizzflow_settings', JSON.stringify(settings));
        }

        function saveSubscriptionSettings(settings) {
            localStorage.setItem('bizzflow_subscription_settings', JSON.stringify(settings));
        }

        function saveFinancial(financial) {
            localStorage.setItem('bizzflow_financial', JSON.stringify(financial));
        }

        function saveInvestments(investments) {
            localStorage.setItem('bizzflow_investments', JSON.stringify(investments));
        }

        function saveStockMovements(movements) {
            localStorage.setItem('bizzflow_stock_movements', JSON.stringify(movements));
        }

        // Funções de UI
        function updateDashboard() {
            const clients = getClients();
            const products = getProducts();
            const sales = getSales();
            const financial = getFinancial();
            const investments = getInvestments();
            const subscriptions = getSubscriptions();
            
            // Atualizar estatísticas
            document.getElementById('totalClientes').textContent = clients.length;
            document.getElementById('totalProdutos').textContent = products.reduce((sum, p) => sum + p.stock, 0);
            
            const today = new Date().toISOString().split('T')[0];
            const todaySales = sales.filter(s => s.date === today);
            document.getElementById('vendasHoje').textContent = todaySales.length;
            
            const totalSales = sales.reduce((sum, s) => sum + s.total, 0);
            document.getElementById('totalVendas').textContent = totalSales.toFixed(2) + ' MZN';
            
            // Atualizar estatísticas financeiras
            document.getElementById('currentBalance').textContent = financial.current_balance.toFixed(2) + ' MZN';
            document.getElementById('monthlyIncome').textContent = financial.monthly_income.toFixed(2) + ' MZN';
            document.getElementById('monthlyExpenses').textContent = financial.monthly_expenses.toFixed(2) + ' MZN';
            document.getElementById('monthlyProfit').textContent = financial.monthly_profit.toFixed(2) + ' MZN';
            
            // Atualizar estatísticas de investimentos
            document.getElementById('roiPercentage').textContent = investments.roi_percentage + '%';
            document.getElementById('growthRate').textContent = investments.growth_rate + '%';
            document.getElementById('totalInvestment').textContent = investments.total_invested.toFixed(2) + ' MZN';
            document.getElementById('profitMargin').textContent = investments.profit_margin + '%';
            
            // Atualizar tabela de vendas recentes
            const recentSalesBody = document.getElementById('recentSalesBody');
            recentSalesBody.innerHTML = '';
            
            sales.slice(-5).reverse().forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.receipt_no}</td>
                    <td>${sale.client_name || 'Cliente Avulso'}</td>
                    <td>${sale.date} ${sale.time || ''}</td>
                    <td>${sale.total.toFixed(2)} MZN</td>
                    <td><span class="badge badge-success">Concluída</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewSale(${sale.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSale(${sale.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                recentSalesBody.appendChild(row);
            });
            
            // Atualizar alertas de stock
            const stockAlertBody = document.getElementById('stockAlertBody');
            stockAlertBody.innerHTML = '';
            
            const lowStockProducts = products.filter(p => p.stock <= p.min_stock);
            lowStockProducts.forEach(product => {
                const status = product.stock === 0 ? 'badge-danger' : 'badge-warning';
                const statusText = product.stock === 0 ? 'Esgotado' : 'Stock Baixo';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name} (${product.code})</td>
                    <td>${product.category}</td>
                    <td>${product.stock}</td>
                    <td>${product.min_stock}</td>
                    <td><span class="badge ${status}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i> Repor Stock
                        </button>
                    </td>
                `;
                stockAlertBody.appendChild(row);
            });
            
            // Atualizar gráficos
            updateCharts();
            
            // Atualizar estatísticas de assinaturas no dashboard
            const activeSubscriptions = subscriptions.filter(s => s.status === 'active');
            document.getElementById('totalAssinaturas').textContent = subscriptions.length;
            document.getElementById('assinaturasAtivas').textContent = activeSubscriptions.length;
            
            const trialSubscriptions = subscriptions.filter(s => s.status === 'trial');
            document.getElementById('assinaturasTrial').textContent = trialSubscriptions.length;
            
            const monthlyRevenue = subscriptions
                .filter(s => s.status === 'active')
                .reduce((sum, s) => sum + s.price, 0);
            document.getElementById('receitaMensal').textContent = monthlyRevenue.toFixed(2) + ' MZN';
        }

        function updateCharts() {
            const sales = getSales();
            const products = getProducts();
            
            // Gráfico de vendas diárias
            const salesByDay = {};
            const last7Days = [...Array(7)].map((_, i) => {
                const d = new Date();
                d.setDate(d.getDate() - i);
                return d.toISOString().split('T')[0];
            }).reverse();
            
            last7Days.forEach(day => {
                salesByDay[day] = 0;
            });
            
            sales.forEach(sale => {
                if (salesByDay[sale.date] !== undefined) {
                    salesByDay[sale.date] += sale.total;
                }
            });
            
            const salesChartCtx = document.getElementById('salesChart').getContext('2d');
            if (window.salesChart) {
                if (window.salesChart && typeof window.salesChart.destroy === 'function') {
    window.salesChart.destroy();
} else {
    console.warn('⚠️ salesChart não disponível para destroy');
}
            
            window.salesChart = new Chart(salesChartCtx, {
                type: 'line',
                data: {
                    labels: last7Days.map(d => d.split('-')[2] + '/' + d.split('-')[1]),
                    datasets: [{
                        label: 'Vendas (MZN)',
                        data: Object.values(salesByDay),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
            
            // Gráfico de categorias
            const categories = {};
            products.forEach(product => {
                if (!categories[product.category]) {
                    categories[product.category] = 0;
                }
                categories[product.category]++;
            });
            
            const categoryChartCtx = document.getElementById('categoryChart').getContext('2d');
            if (window.categoryChart) {
                window.categoryChart.destroy();
            }
            
            window.categoryChart = new Chart(categoryChartCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c',
                            '#9b59b6',
                            '#1abc9c',
                            '#d35400'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateClientsTable() {
            const clients = getClients();
            const clientsBody = document.getElementById('clientesBody');
            clientsBody.innerHTML = '';
            
            clients.forEach(client => {
                const typeBadge = client.type === 'vip' ? 'badge-warning' : 
                                 client.type === 'corporate' ? 'badge-primary' : 
                                 client.type === 'wholesale' ? 'badge-info' : 'badge-success';
                const typeText = client.type === 'vip' ? 'VIP' : 
                                client.type === 'corporate' ? 'Corporativo' : 
                                client.type === 'wholesale' ? 'Atacado' : 'Regular';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.id}</td>
                    <td>${client.name}</td>
                    <td>${client.phone}</td>
                    <td>${client.email || '-'}</td>
                    <td><span class="badge ${typeBadge}">${typeText}</span></td>
                    <td>${client.total_purchases ? client.total_purchases.toFixed(2) + ' MZN' : '0 MZN'}</td>
                    <td>${client.last_purchase || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editClient(${client.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                clientsBody.appendChild(row);
            });
            
            // Atualizar contadores
            document.getElementById('totalClientesCount').textContent = clients.length;
            document.getElementById('vipClientesCount').textContent = clients.filter(c => c.type === 'vip').length;
            document.getElementById('clientesAtivosCount').textContent = clients.filter(c => c.total_purchases > 0).length;
            document.getElementById('clientesInativosCount').textContent = clients.filter(c => !c.total_purchases || c.total_purchases === 0).length;
            document.getElementById('clientCount').textContent = clients.length;
            document.getElementById('totalClients').textContent = clients.length;
        }

        function updateProductsTable() {
            const products = getProducts();
            const produtosBody = document.getElementById('produtosBody');
            produtosBody.innerHTML = '';
            
            products.forEach(product => {
                const stockStatus = product.stock <= product.min_stock ? 
                    (product.stock === 0 ? 'badge-danger' : 'badge-warning') : 'badge-success';
                const stockText = product.stock <= product.min_stock ? 
                    (product.stock === 0 ? 'Esgotado' : 'Baixo') : 'Normal';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.price.toFixed(2)} MZN</td>
                    <td>${product.cost ? product.cost.toFixed(2) + ' MZN' : '-'}</td>
                    <td>
                        <span class="badge ${stockStatus}">${product.stock}</span>
                    </td>
                    <td>${stockText}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                produtosBody.appendChild(row);
            });
            
            // Atualizar contadores
            document.getElementById('totalProdutosCount').textContent = products.length;
            document.getElementById('produtosStockBaixo').textContent = products.filter(p => p.stock > 0 && p.stock <= p.min_stock).length;
            document.getElementById('produtosEsgotados').textContent = products.filter(p => p.stock === 0).length;
            
            const categories = [...new Set(products.map(p => p.category))];
            document.getElementById('totalCategorias').textContent = categories.length;
            document.getElementById('productCount').textContent = products.length;
        }

        function updateSalesTable() {
            const sales = getSales();
            const vendasBody = document.getElementById('vendasBody');
            vendasBody.innerHTML = '';
            
            sales.reverse().forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.receipt_no}</td>
                    <td>${sale.client_name || 'Cliente Avulso'}</td>
                    <td>${sale.date} ${sale.time || ''}</td>
                    <td>${sale.items.length} itens</td>
                    <td>${sale.total.toFixed(2)} MZN</td>
                    <td>${sale.payment_method}</td>
                    <td><span class="badge badge-success">Concluída</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewSale(${sale.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSale(${sale.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                vendasBody.appendChild(row);
            });
            
            // Atualizar contadores
            const today = new Date().toISOString().split('T')[0];
            const todaySales = sales.filter(s => s.date === today);
            document.getElementById('vendasHojeCount').textContent = todaySales.length;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekAgoStr = weekAgo.toISOString().split('T')[0];
            const weekSales = sales.filter(s => s.date >= weekAgoStr);
            document.getElementById('vendasSemanaCount').textContent = weekSales.length;
            
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            const monthAgoStr = monthAgo.toISOString().split('T')[0];
            const monthSales = sales.filter(s => s.date >= monthAgoStr);
            document.getElementById('vendasMesCount').textContent = monthSales.length;
            
            const monthTotal = monthSales.reduce((sum, s) => sum + s.total, 0);
            document.getElementById('faturamentoMes').textContent = monthTotal.toFixed(2) + ' MZN';
            document.getElementById('saleCount').textContent = sales.length;
        }

        function updatePlans() {
            const plans = getPlans();
            const plansGrid = document.getElementById('plansGrid');
            plansGrid.innerHTML = '';
            
            plans.forEach(plan => {
                const planCard = document.createElement('div');
                planCard.className = `plan-card ${plan.is_popular ? 'popular' : ''}`;
                
                let featuresHtml = '';
                const featureMap = {
                    'dashboard': 'Dashboard completo',
                    'clientes': 'Gestão de clientes',
                    'produtos': 'Gestão de produtos',
                    'vendas': 'Gestão de vendas',
                    'relatorios_basicos': 'Relatórios básicos',
                    'relatorios_avancados': 'Relatórios avançados',
                    'exportar': 'Exportação de dados',
                    'importar': 'Importação de dados',
                    'suporte_prioritario': 'Suporte prioritário',
                    'api_access': 'Acesso à API'
                };
                
                plan.features.forEach(feature => {
                    if (featureMap[feature]) {
                        featuresHtml += `<li><i class="fas fa-check"></i> ${featureMap[feature]}</li>`;
                    }
                });
                
                planCard.innerHTML = `
                    ${plan.is_popular ? '<div class="plan-badge">Mais Popular</div>' : ''}
                    <h3 style="color: var(--bizzflow-primary); margin-bottom: 10px;">${plan.name}</h3>
                    <p style="color: var(--bizzflow-gray); margin-bottom: 20px; min-height: 60px;">${plan.description}</p>
                    <div class="plan-price">
                        ${plan.price.toFixed(2)} MZN <span>/mês</span>
                    </div>
                    <ul class="plan-features">
                        ${featuresHtml}
                        <li><i class="fas fa-users"></i> Até ${plan.max_clients} clientes</li>
                        <li><i class="fas fa-box"></i> Até ${plan.max_products} produtos</li>
                        <li><i class="fas fa-clock"></i> ${plan.trial_days} dias de teste</li>
                    </ul>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" style="flex: 1;" onclick="editPlan(${plan.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger" onclick="deletePlan(${plan.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                plansGrid.appendChild(planCard);
            });
            
            // Carregar configurações de teste
            const settings = getSettings();
            document.getElementById('trialDays').value = settings.trial_days || 7;
            document.getElementById('trialMaxClients').value = settings.trial_max_clients || 50;
            document.getElementById('trialMaxProducts').value = settings.trial_max_products || 100;
            document.getElementById('trialMaxSales').value = settings.trial_max_sales || 100;
            document.getElementById('trialAutoCancel').checked = settings.trial_auto_cancel !== false;
            document.getElementById('trialNotifications').checked = settings.trial_notifications !== false;
            document.getElementById('trialCardRequired').checked = settings.trial_card_required || false;
            
            // Carregar features selecionadas
            const trialFeaturesSelect = document.getElementById('trialFeatures');
            Array.from(trialFeaturesSelect.options).forEach(option => {
                option.selected = settings.trial_features && settings.trial_features.includes(option.value);
            });
        }

        function updateSubscriptions() {
            const subscriptions = getSubscriptions();
            const assinaturasBody = document.getElementById('assinaturasBody');
            assinaturasBody.innerHTML = '';
            
            subscriptions.forEach(subscription => {
                let statusClass = 'status-active';
                let statusText = 'Ativa';
                
                if (subscription.status === 'trial') {
                    statusClass = 'status-trial';
                    statusText = 'Em Teste';
                } else if (subscription.status === 'pending') {
                    statusClass = 'status-pending';
                    statusText = 'Pendente';
                } else if (subscription.status === 'cancelled') {
                    statusClass = 'status-expired';
                    statusText = 'Cancelada';
                } else if (subscription.status === 'expired') {
                    statusClass = 'status-expired';
                    statusText = 'Expirada';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${subscription.client_name}</td>
                    <td>${subscription.plan_name}</td>
                    <td>${subscription.start_date}</td>
                    <td>${subscription.end_date || '-'}</td>
                    <td>${subscription.next_payment || '-'}</td>
                    <td>${subscription.price.toFixed(2)} MZN</td>
                    <td>
                        <span class="subscription-status ${statusClass}">
                            <i class="fas fa-circle" style="font-size: 0.7rem;"></i>
                            ${statusText}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editSubscription(${subscription.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSubscription(${subscription.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                assinaturasBody.appendChild(row);
            });
            
            // Atualizar contadores
            document.getElementById('subscriptionCount').textContent = subscriptions.length;
            
            const activeSubscriptions = subscriptions.filter(s => s.status === 'active');
            document.getElementById('assinaturasAtivas').textContent = activeSubscriptions.length;
            
            const trialSubscriptions = subscriptions.filter(s => s.status === 'trial');
            document.getElementById('assinaturasTrial').textContent = trialSubscriptions.length;
            
            const monthlyRevenue = activeSubscriptions.reduce((sum, s) => sum + s.price, 0);
            document.getElementById('receitaMensal').textContent = monthlyRevenue.toFixed(2) + ' MZN';
        }

        function updateReports() {
            const sales = getSales();
            const products = getProducts();
            const clients = getClients();
            const subscriptions = getSubscriptions();
            const financial = getFinancial();
            
            const period = document.getElementById('reportPeriod').value;
            
            let filteredSales = [];
            const now = new Date();
            
            switch(period) {
                case 'today':
                    const today = new Date().toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date === today);
                    break;
                case 'week':
                    const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    const monthAgoStr = monthAgo.toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= monthAgoStr);
                    break;
                case 'quarter':
                    const quarterAgo = new Date();
                    quarterAgo.setMonth(quarterAgo.getMonth() - 3);
                    const quarterAgoStr = quarterAgo.toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= quarterAgoStr);
                    break;
                case 'year':
                    const yearAgo = new Date();
                    yearAgo.setFullYear(yearAgo.getFullYear() - 1);
                    const yearAgoStr = yearAgo.toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= yearAgoStr);
                    break;
            }
            
            // Atualizar estatísticas
            const totalSalesAmount = filteredSales.reduce((sum, s) => sum + s.total, 0);
            const totalItems = filteredSales.reduce((sum, s) => sum + s.items.reduce((itemSum, i) => itemSum + i.quantity, 0), 0);
            const avgSale = filteredSales.length > 0 ? totalSalesAmount / filteredSales.length : 0;
            
            document.getElementById('reportTotalSales').textContent = totalSalesAmount.toFixed(2) + ' MZN';
            document.getElementById('reportTotalItems').textContent = totalItems;
            document.getElementById('reportAvgSale').textContent = avgSale.toFixed(2) + ' MZN';
            
            // Encontrar produto mais vendido
            const productSales = {};
            filteredSales.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productSales[item.product_id]) {
                        productSales[item.product_id] = 0;
                    }
                    productSales[item.product_id] += item.quantity;
                });
            });
            
            let topProduct = '-';
            let maxSales = 0;
            for (const [productId, quantity] of Object.entries(productSales)) {
                if (quantity > maxSales) {
                    const product = products.find(p => p.id == productId);
                    if (product) {
                        topProduct = product.name;
                        maxSales = quantity;
                    }
                }
            }
            
            document.getElementById('reportTopProduct').textContent = topProduct;
            
            // Atualizar gráficos de relatórios
            updateReportCharts(filteredSales, subscriptions);
            
            // Atualizar tabelas de relatórios
            updateReportTables(filteredSales, products, clients, subscriptions, financial);
        }

        function updateReportTables(salesData, productsData, clientsData, subscriptionsData, financialData) {
            // Top Produtos
            const topProductsBody = document.getElementById('topProductsBody');
            topProductsBody.innerHTML = '';
            
            const productQuantities = {};
            salesData.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productQuantities[item.product_id]) {
                        productQuantities[item.product_id] = {
                            quantity: 0,
                            revenue: 0,
                            product: productsData.find(p => p.id == item.product_id)
                        };
                    }
                    productQuantities[item.product_id].quantity += item.quantity;
                    productQuantities[item.product_id].revenue += item.total;
                });
            });
            
            const topProducts = Object.values(productQuantities)
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 10);
            
            topProducts.forEach(item => {
                if (item.product) {
                    const profitMargin = item.product.cost ? 
                        ((item.product.price - item.product.cost) / item.product.price * 100).toFixed(1) + '%' : '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.product.name}</td>
                        <td>${item.product.category}</td>
                        <td>${item.quantity}</td>
                        <td>${item.revenue.toFixed(2)} MZN</td>
                        <td>${profitMargin}</td>
                    `;
                    topProductsBody.appendChild(row);
                }
            });
            
            // Top Clientes
            const topClientsBody = document.getElementById('topClientsBody');
            topClientsBody.innerHTML = '';
            
            const clientPurchases = {};
            salesData.forEach(sale => {
                if (sale.client_id) {
                    if (!clientPurchases[sale.client_id]) {
                        clientPurchases[sale.client_id] = {
                            total: 0,
                            count: 0,
                            client: clientsData.find(c => c.id == sale.client_id)
                        };
                    }
                    clientPurchases[sale.client_id].total += sale.total;
                    clientPurchases[sale.client_id].count++;
                }
            });
            
            const topClients = Object.values(clientPurchases)
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);
            
            topClients.forEach(item => {
                if (item.client) {
                    const avgTicket = item.count > 0 ? (item.total / item.count).toFixed(2) : '0.00';
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.client.name}</td>
                        <td>${item.client.type === 'vip' ? 'VIP' : item.client.type === 'corporate' ? 'Corporativo' : 'Regular'}</td>
                        <td>${item.total.toFixed(2)} MZN</td>
                        <td>${salesData.filter(s => s.client_id == item.client.id).map(s => s.date).sort().reverse()[0] || '-'}</td>
                        <td>${avgTicket} MZN</td>
                    `;
                    topClientsBody.appendChild(row);
                }
            });
            
            // Relatório Financeiro
            const financialReportBody = document.getElementById('financialReportBody');
            financialReportBody.innerHTML = '';
            
            // Simular dados financeiros por mês
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dec'];
            const currentMonth = new Date().getMonth();
            
            for (let i = 5; i >= 0; i--) {
                const monthIndex = (currentMonth - i + 12) % 12;
                const revenue = Math.random() * 100000 + 50000;
                const expenses = Math.random() * 50000 + 25000;
                const profit = revenue - expenses;
                const margin = (profit / revenue * 100).toFixed(1);
                const growth = i > 0 ? Math.random() * 20 - 5 : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${months[monthIndex]} 2024</td>
                    <td>${revenue.toFixed(2)} MZN</td>
                    <td>${expenses.toFixed(2)} MZN</td>
                    <td>${profit.toFixed(2)} MZN</td>
                    <td>${margin}%</td>
                    <td>${growth > 0 ? '+' : ''}${growth.toFixed(1)}%</td>
                `;
                financialReportBody.appendChild(row);
            }
            
            // Relatório de Assinaturas
            const subscriptionsReportBody = document.getElementById('subscriptionsReportBody');
            subscriptionsReportBody.innerHTML = '';
            
            const planStats = {};
            subscriptionsData.forEach(sub => {
                if (!planStats[sub.plan_name]) {
                    planStats[sub.plan_name] = {
                        active: 0,
                        revenue: 0,
                        total: 0
                    };
                }
                planStats[sub.plan_name].total++;
                if (sub.status === 'active') {
                    planStats[sub.plan_name].active++;
                    planStats[sub.plan_name].revenue += sub.price;
                }
            });
            
            for (const [planName, stats] of Object.entries(planStats)) {
                const retentionRate = stats.total > 0 ? (stats.active / stats.total * 100).toFixed(1) : '0.0';
                const churnRate = (100 - parseFloat(retentionRate)).toFixed(1);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${planName}</td>
                    <td>${stats.active}</td>
                    <td>${stats.revenue.toFixed(2)} MZN</td>
                    <td>${retentionRate}%</td>
                    <td>${churnRate}%</td>
                `;
                subscriptionsReportBody.appendChild(row);
            }
        }

        function updateReportCharts(salesData, subscriptionsData) {
            // Gráfico de vendas por dia
            const salesByDay = {};
            salesData.forEach(sale => {
                if (!salesByDay[sale.date]) {
                    salesByDay[sale.date] = 0;
                }
                salesByDay[sale.date] += sale.total;
            });
            
            const reportSalesChartCtx = document.getElementById('reportSalesChart').getContext('2d');
            if (window.reportSalesChart) {
                window.reportSalesChart.destroy();
            }
            
            const sortedDates = Object.keys(salesByDay).sort();
            window.reportSalesChart = new Chart(reportSalesChartCtx, {
                type: 'bar',
                data: {
                    labels: sortedDates.map(d => d.split('-')[2] + '/' + d.split('-')[1]),
                    datasets: [{
                        label: 'Vendas (MZN)',
                        data: sortedDates.map(d => salesByDay[d]),
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Gráfico de top produtos
            const productQuantities = {};
            salesData.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productQuantities[item.name]) {
                        productQuantities[item.name] = 0;
                    }
                    productQuantities[item.name] += item.quantity;
                });
            });
            
            const topProducts = Object.entries(productQuantities)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const reportProductsChartCtx = document.getElementById('reportProductsChart').getContext('2d');
            if (window.reportProductsChart) {
                window.reportProductsChart.destroy();
            }
            
            window.reportProductsChart = new Chart(reportProductsChartCtx, {
                type: 'pie',
                data: {
                    labels: topProducts.map(p => p[0]),
                    datasets: [{
                        data: topProducts.map(p => p[1]),
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c',
                            '#9b59b6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateStockPage() {
            const products = getProducts();
            const stockMovements = getStockMovements();
            const clients = getClients();
            const suppliers = getSuppliers();
            
            // Atualizar movimentações de stock
            const stockMovementsBody = document.getElementById('stockMovementsBody');
            stockMovementsBody.innerHTML = '';
            
            stockMovements.slice(-10).reverse().forEach(movement => {
                const typeBadge = movement.type === 'entrada' ? 'badge-success' : 'badge-danger';
                const typeText = movement.type === 'entrada' ? 'Entrada' : 'Saída';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${movement.date}</td>
                    <td>${movement.product_name}</td>
                    <td><span class="badge ${typeBadge}">${typeText}</span></td>
                    <td>${movement.quantity}</td>
                    <td>${movement.responsible}</td>
                `;
                stockMovementsBody.appendChild(row);
            });
            
            // Atualizar avisos de stock
            const stockWarningsList = document.getElementById('stockWarningsList');
            stockWarningsList.innerHTML = '';
            
            const lowStockProducts = products.filter(p => p.stock <= p.min_stock);
            if (lowStockProducts.length === 0) {
                stockWarningsList.innerHTML = '<div style="padding: 15px; text-align: center; color: #27ae60;">Todos os produtos com stock adequado!</div>';
            } else {
                lowStockProducts.forEach(product => {
                    const warningDiv = document.createElement('div');
                    warningDiv.style.cssText = `
                        padding: 12px;
                        border-left: 4px solid ${product.stock === 0 ? '#e74c3c' : '#f39c12'};
                        background: ${product.stock === 0 ? '#fdf2f2' : '#fef9e7'};
                        margin-bottom: 10px;
                        border-radius: 0 8px 8px 0;
                    `;
                    warningDiv.innerHTML = `
                        <div style="font-weight: 600; margin-bottom: 5px;">${product.name}</div>
                        <div style="font-size: 0.9rem; color: #666;">
                            Stock: ${product.stock} | Mínimo: ${product.min_stock}
                            ${product.stock === 0 ? ' - <span style="color: #e74c3c;">ESGOTADO</span>' : ' - <span style="color: #f39c12;">STOCK BAIXO</span>'}
                        </div>
                    `;
                    stockWarningsList.appendChild(warningDiv);
                });
            }
            
            // Atualizar relatório de stock
            const stockReportBody = document.getElementById('stockReportBody');
            stockReportBody.innerHTML = '';
            
            products.forEach(product => {
                const stockValue = product.stock * (product.cost || product.price * 0.7);
                const status = product.stock <= product.min_stock ? 
                    (product.stock === 0 ? 'Esgotado' : 'Baixo') : 'Normal';
                const statusClass = product.stock <= product.min_stock ? 
                    (product.stock === 0 ? 'badge-danger' : 'badge-warning') : 'badge-success';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.stock}</td>
                    <td>${product.min_stock}</td>
                    <td>${product.min_stock * 3}</td>
                    <td>${stockValue.toFixed(2)} MZN</td>
                    <td><span class="badge ${statusClass}">${status}</span></td>
                `;
                stockReportBody.appendChild(row);
            });
        }

        // Funções de Modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Inicializar modal de venda
        function initSaleModal() {
            const products = getProducts();
            const clients = getClients();
            
            // Popular produtos disponíveis
            const availableProductsList = document.getElementById('availableProductsList');
            availableProductsList.innerHTML = '';
            
            products.forEach(product => {
                if (product.stock > 0) {
                    const productDiv = document.createElement('div');
                    productDiv.className = 'product-item';
                    productDiv.style.cssText = `
                        padding: 12px;
                        border: 1px solid #eaeaea;
                        border-radius: 8px;
                        margin-bottom: 10px;
                        cursor: pointer;
                        transition: all 0.3s;
                        background: white;
                    `;
                    productDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${product.name}</strong> (${product.code})
                                <div style="font-size: 0.9em; color: ${product.stock <= product.min_stock ? '#e74c3c' : '#27ae60'};">Stock: ${product.stock}</div>
                            </div>
                            <div style="font-weight: bold; color: var(--bizzflow-primary);">${product.price.toFixed(2)} MZN</div>
                        </div>
                    `;
                    
                    productDiv.addEventListener('click', () => {
                        addToSale(product);
                    });
                    
                    productDiv.addEventListener('mouseenter', () => {
                        productDiv.style.backgroundColor = '#f8f9fa';
                        productDiv.style.transform = 'translateY(-2px)';
                        productDiv.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
                    });
                    
                    productDiv.addEventListener('mouseleave', () => {
                        productDiv.style.backgroundColor = 'white';
                        productDiv.style.transform = 'translateY(0)';
                        productDiv.style.boxShadow = 'none';
                    });
                    
                    availableProductsList.appendChild(productDiv);
                }
            });
            
            // Popular dropdown de clientes
            const saleClientSelect = document.getElementById('saleClient');
            saleClientSelect.innerHTML = '<option value="">Cliente Avulso</option>';
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.name} (${client.phone})`;
                saleClientSelect.appendChild(option);
            });
            
            // Limpar itens da venda
            window.currentSaleItems = [];
            updateSaleSummary();
        }

        // Inicializar modal de entrada de stock
        function initStockEntryModal() {
            const products = getProducts();
            const suppliers = getSuppliers();
            
            // Popular dropdown de produtos
            const productSelect = document.getElementById('stockEntryProduct');
            productSelect.innerHTML = '<option value="">Selecionar Produto</option>';
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (${product.code}) - Stock: ${product.stock}`;
                productSelect.appendChild(option);
            });
            
            // Popular dropdown de fornecedores
            const supplierSelect = document.getElementById('stockEntrySupplier');
            supplierSelect.innerHTML = '<option value="">Selecionar Fornecedor</option>';
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = supplier.name;
                supplierSelect.appendChild(option);
            });
        }

        // Inicializar modal de saída de stock
        function initStockOutputModal() {
            const products = getProducts();
            const clients = getClients();
            
            // Popular dropdown de produtos
            const productSelect = document.getElementById('stockOutputProduct');
            productSelect.innerHTML = '<option value="">Selecionar Produto</option>';
            products.forEach(product => {
                if (product.stock > 0) {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.name} (${product.code}) - Stock: ${product.stock}`;
                    productSelect.appendChild(option);
                }
            });
            
            // Popular dropdown de clientes
            const clientSelect = document.getElementById('stockOutputClient');
            clientSelect.innerHTML = '<option value="">Selecionar Cliente</option>';
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.name} (${client.phone})`;
                clientSelect.appendChild(option);
            });
        }

        // Funções de Exportação/Importação
        function showExportOptions() {
            const exportOptions = document.getElementById('exportOptions');
            exportOptions.style.display = exportOptions.style.display === 'block' ? 'none' : 'block';
        }

        function exportData(type, format) {
            let data = [];
            let filename = '';
            
            switch(type) {
                case 'clientes':
                    data = getClients();
                    filename = `clientes_${new Date().toISOString().split('T')[0]}`;
                    break;
                case 'produtos':
                    data = getProducts();
                    filename = `produtos_${new Date().toISOString().split('T')[0]}`;
                    break;
                case 'vendas':
                    data = getSales();
                    filename = `vendas_${new Date().toISOString().split('T')[0]}`;
                    break;
                case 'assinaturas':
                    data = getSubscriptions();
                    filename = `assinaturas_${new Date().toISOString().split('T')[0]}`;
                    break;
                case 'all':
                    const allData = {
                        clientes: getClients(),
                        produtos: getProducts(),
                        vendas: getSales(),
                        fornecedores: getSuppliers(),
                        assinaturas: getSubscriptions(),
                        planos: getPlans(),
                        equipa: getTeam(),
                        settings: getSettings(),
                        financial: getFinancial(),
                        investments: getInvestments(),
                        export_date: new Date().toISOString()
                    };
                    data = allData;
                    filename = `backup_completo_${new Date().toISOString().split('T')[0]}`;
                    break;
            }
            
            if (format === 'csv') {
                exportToCSV(data, filename);
            } else if (format === 'excel') {
                exportToExcel(data, filename);
            } else if (format === 'pdf') {
                exportToPDF(data, filename);
            }
            
            showAlert(`Dados exportados com sucesso em formato ${format.toUpperCase()}!`, 'success');
        }

        function exportReportData(format) {
            const period = document.getElementById('reportPeriod').value;
            const periodText = document.getElementById('reportPeriod').options[document.getElementById('reportPeriod').selectedIndex].text;
            
            const sales = getSales();
            const products = getProducts();
            const clients = getClients();
            
            let filteredSales = [];
            const now = new Date();
            
            switch(period) {
                case 'today':
                    const today = new Date().toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date === today);
                    break;
                case 'week':
                    const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    const monthAgoStr = monthAgo.toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= monthAgoStr);
                    break;
                case 'quarter':
                    const quarterAgo = new Date();
                    quarterAgo.setMonth(quarterAgo.getMonth() - 3);
                    const quarterAgoStr = quarterAgo.toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= quarterAgoStr);
                    break;
                case 'year':
                    const yearAgo = new Date();
                    yearAgo.setFullYear(yearAgo.getFullYear() - 1);
                    const yearAgoStr = yearAgo.toISOString().split('T')[0];
                    filteredSales = sales.filter(s => s.date >= yearAgoStr);
                    break;
            }
            
            const totalSalesAmount = filteredSales.reduce((sum, s) => sum + s.total, 0);
            const totalItems = filteredSales.reduce((sum, s) => sum + s.items.reduce((itemSum, i) => itemSum + i.quantity, 0), 0);
            const avgSale = filteredSales.length > 0 ? totalSalesAmount / filteredSales.length : 0;
            
            // Encontrar produto mais vendido
            const productSales = {};
            filteredSales.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productSales[item.product_id]) {
                        productSales[item.product_id] = 0;
                    }
                    productSales[item.product_id] += item.quantity;
                });
            });
            
            let topProduct = '-';
            let maxSales = 0;
            for (const [productId, quantity] of Object.entries(productSales)) {
                if (quantity > maxSales) {
                    const product = products.find(p => p.id == productId);
                    if (product) {
                        topProduct = product.name;
                        maxSales = quantity;
                    }
                }
            }
            
            const reportData = {
                periodo: periodText,
                total_vendas: totalSalesAmount.toFixed(2) + ' MZN',
                itens_vendidos: totalItems,
                venda_media: avgSale.toFixed(2) + ' MZN',
                produto_mais_vendido: topProduct,
                total_vendas_numerico: totalSalesAmount,
                data_exportacao: new Date().toLocaleString('pt-MZ'),
                detalhes_vendas: filteredSales.map(sale => ({
                    recibo: sale.receipt_no,
                    cliente: sale.client_name || 'Cliente Avulso',
                    data: sale.date,
                    total: sale.total,
                    itens: sale.items.map(item => `${item.name} (${item.quantity}x ${item.price} MZN)`).join(', ')
                }))
            };
            
            if (format === 'csv') {
                exportToCSV([reportData], `relatorio_vendas_${period}_${new Date().toISOString().split('T')[0]}`);
            } else if (format === 'excel') {
                exportToExcel([reportData], `relatorio_vendas_${period}_${new Date().toISOString().split('T')[0]}`);
            } else if (format === 'pdf') {
                exportToPDF([reportData], `relatorio_vendas_${period}_${new Date().toISOString().split('T')[0]}`);
            }
        }

        function exportStockData(format) {
            const products = getProducts();
            const stockMovements = getStockMovements();
            
            const stockReport = products.map(product => {
                const stockValue = product.stock * (product.cost || product.price * 0.7);
                const status = product.stock <= product.min_stock ? 
                    (product.stock === 0 ? 'Esgotado' : 'Baixo') : 'Normal';
                
                return {
                    codigo: product.code,
                    produto: product.name,
                    categoria: product.category,
                    stock_atual: product.stock,
                    stock_minimo: product.min_stock,
                    stock_maximo: product.min_stock * 3,
                    valor_stock: stockValue.toFixed(2) + ' MZN',
                    status: status
                };
            });
            
            const filename = `relatorio_stock_${new Date().toISOString().split('T')[0]}`;
            
            if (format === 'csv') {
                exportToCSV(stockReport, filename);
            } else if (format === 'excel') {
                exportToExcel(stockReport, filename);
            } else if (format === 'pdf') {
                exportToPDF(stockReport, filename);
            }
            
            showAlert(`Relatório de stock exportado com sucesso em formato ${format.toUpperCase()}!`, 'success');
        }

        function exportToCSV(data, filename) {
            let csvContent = '';
            
            if (Array.isArray(data)) {
                // Se for um array, exportar como CSV simples
                if (data.length > 0) {
                    const headers = Object.keys(data[0]);
                    csvContent = headers.join(',') + '\n';
                    
                    data.forEach(item => {
                        const row = headers.map(header => {
                            const value = item[header];
                            return typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value;
                        }).join(',');
                        csvContent += row + '\n';
                    });
                }
            } else {
                // Se for um objeto (backup completo), exportar múltiplas sheets
                csvContent = 'Bizz Flow CRM - Backup Completo\n';
                csvContent += `Data de Exportação: ${new Date().toLocaleString('pt-MZ')}\n\n`;
                
                for (const [key, value] of Object.entries(data)) {
                    if (Array.isArray(value)) {
                        csvContent += `\n=== ${key.toUpperCase()} (${value.length} registos) ===\n`;
                        if (value.length > 0) {
                            const headers = Object.keys(value[0]);
                            csvContent += headers.join(',') + '\n';
                            
                            value.forEach(item => {
                                const row = headers.map(header => {
                                    const val = item[header];
                                    return typeof val === 'string' ? `"${val.replace(/"/g, '""')}"` : val;
                                }).join(',');
                                csvContent += row + '\n';
                            });
                        }
                    }
                }
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}.csv`;
            link.click();
        }

        function exportToExcel(data, filename) {
            // Para simplificar, vamos criar um CSV com extensão .xlsx
            // Em uma implementação real, você usaria uma biblioteca como SheetJS
            exportToCSV(data, filename.replace('.xlsx', '.csv'));
            
            // Simular exportação para Excel
            showAlert('Funcionalidade Excel completa requer biblioteca adicional. CSV gerado com sucesso!', 'info');
        }

        function exportToPDF(data, filename) {
            // Em uma implementação real, você usaria uma biblioteca como jsPDF
            let pdfContent = `
                <html>
                <head>
                    <title>${filename}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #1a5f7a; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>Bizz Flow CRM - Relatório</h1>
                    <p>Data de Exportação: ${new Date().toLocaleString('pt-MZ')}</p>
            `;
            
            if (Array.isArray(data) && data.length > 0) {
                pdfContent += '<table>';
                const headers = Object.keys(data[0]);
                pdfContent += '<tr>';
                headers.forEach(header => {
                    pdfContent += `<th>${header}</th>`;
                });
                pdfContent += '</tr>';
                
                data.forEach(item => {
                    pdfContent += '<tr>';
                    headers.forEach(header => {
                        pdfContent += `<td>${item[header]}</td>`;
                    });
                    pdfContent += '</tr>';
                });
                pdfContent += '</table>';
            }
            
            pdfContent += '</body></html>';
            
            // Abrir em nova janela para impressão/salvar como PDF
            const printWindow = window.open('', '_blank');
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
            
            showAlert('PDF gerado com sucesso! Utilize a opção de impressão do navegador para salvar como PDF.', 'info');
        }

        function showImportTemplate(type) {
            let templateContent = '';
            let filename = '';
            
            switch(type) {
                case 'clientes':
                    templateContent = 'Nome,Telefone,Email,Endereço,NIF,Tipo,Observações\nJoão Silva,+258 84 123 4567,joao@email.com,Maputo,123456789,VIP,Cliente regular\nMaria Santos,+258 85 987 6543,maria@email.com,Matola,987654321,Regular,Sem observações';
                    filename = 'template_clientes.csv';
                    break;
                case 'produtos':
                    templateContent = 'Código,Nome,Categoria,Preço,Custo,Stock,Stock_Mínimo,Fornecedor,Descrição\nPROD001,Arroz 5kg,Alimentação,350.00,280.00,45,10,Fornecedor A,Arroz branco de alta qualidade\nPROD002,Feijão 1kg,Alimentação,120.00,90.00,28,15,Fornecedor A,Feijão vermelho';
                    filename = 'template_produtos.csv';
                    break;
                case 'vendas':
                    templateContent = 'Data,Cliente,Produtos,Quantidades,Total,Forma_Pagamento,Observações\n2024-01-20,João Silva,Arroz 5kg;Feijão 1kg,2;3,940.00,Multicaixa,Venda normal\n2024-01-19,Maria Santos,Óleo 1L;Sabão em Pó,1;2,320.00,Dinheiro,Pagamento à vista';
                    filename = 'template_vendas.csv';
                    break;
                case 'fornecedores':
                    templateContent = 'Nome,Contacto,Email,Produtos_Fornecidos,Avaliação,Observações\nFornecedor A,+258 84 111 2222,fornecedorA@email.com,Arroz;Feijão;Açúcar,4.5,Entrega rápida\nFornecedor B,+258 85 333 4444,fornecedorB@email.com,Óleo;Margarina,4.2,Produtos de qualidade';
                    filename = 'template_fornecedores.csv';
                    break;
            }
            
            const blob = new Blob([templateContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            
            showAlert(`Template ${type} baixado com sucesso!`, 'success');
        }

        function downloadTemplate(type) {
            showImportTemplate(type);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar dados
            initializeData();
            
            // Definir data atual
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('pt-MZ', options);
            
            // Login form (administração)
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Autenticação simples
                const validCredentials = [
                    {user: 'admin', pass: 'admin123', name: 'Administrador', role: 'Super Admin'},
                    {user: 'manager', pass: 'manager123', name: 'Gestor', role: 'Gestor'},
                    {user: 'seller', pass: 'seller123', name: 'Vendedor', role: 'Vendedor'}
                ];
                
                const user = validCredentials.find(u => u.user === username && u.pass === password);
                
                if (user) {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'flex';
                    
                    // Atualizar informações do utilizador
                    document.getElementById('currentUserName').textContent = user.name;
                    document.getElementById('currentUserRole').textContent = user.role;
                    document.getElementById('topbarUserName').textContent = user.name;
                    document.getElementById('userAvatar').textContent = user.name.charAt(0);
                    document.getElementById('topbarUserAvatar').textContent = user.name.charAt(0);
                    
                    // Inicializar aplicação
                    updateDashboard();
                    updateClientsTable();
                    updateProductsTable();
                    updateSalesTable();
                    updatePlans();
                    updateSubscriptions();
                    updateReports();
                    updateStockPage();
                } else {
                    alert('Credenciais inválidas! Utilize as credenciais de demonstração.');
                }
            });
            
            // Login de investidor
            document.getElementById('investorLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                // Simulação de login de investidor
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                
                // Mostrar dashboard de investimentos
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                document.querySelector('[data-page="investimentos"]').classList.add('active');
                
                document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
                document.getElementById('investimentosPage').style.display = 'block';
                
                document.getElementById('pageTitle').textContent = 'Dashboard do Investidor';
                document.getElementById('pageSubtitle').textContent = 'Análise de performance e métricas financeiras';
                
                // Atualizar informações do utilizador
                document.getElementById('currentUserName').textContent = 'Investidor';
                document.getElementById('currentUserRole').textContent = 'Investidor';
                document.getElementById('topbarUserName').textContent = 'Investidor';
                document.getElementById('userAvatar').textContent = 'I';
                document.getElementById('topbarUserAvatar').textContent = 'I';
                
                updateDashboard();
            });
            
            // Login de cliente
            document.getElementById('customerLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                // Simulação de login de cliente
                alert('Área do cliente em desenvolvimento. Por enquanto, utilize o login de administração.');
            });
            
            // Tabs na tela de login
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    document.getElementById(tabId + 'Tab').classList.add('active');
                });
            });
            
            // Botão de logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
            });
            
            // Navegação no menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    
                    // Atualizar item ativo do menu
                    document.querySelectorAll('.menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Mostrar página selecionada
                    document.querySelectorAll('.page-content').forEach(p => {
                        p.style.display = 'none';
                    });
                    
                    if (page === 'dashboard') {
                        document.getElementById('dashboardPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Dashboard';
                        document.getElementById('pageSubtitle').textContent = 'Visão geral do seu negócio em tempo real';
                    } else if (page === 'clientes') {
                        document.getElementById('clientesPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Clientes';
                        document.getElementById('pageSubtitle').textContent = 'Gestão de clientes e contactos';
                        updateClientsTable();
                    } else if (page === 'produtos') {
                        document.getElementById('produtosPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Produtos';
                        document.getElementById('pageSubtitle').textContent = 'Gestão de stock e produtos';
                        updateProductsTable();
                    } else if (page === 'vendas') {
                        document.getElementById('vendasPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Vendas';
                        document.getElementById('pageSubtitle').textContent = 'Registo e histórico de vendas';
                        updateSalesTable();
                    } else if (page === 'financeiro') {
                        document.getElementById('financeiroPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Financeiro';
                        document.getElementById('pageSubtitle').textContent = 'Gestão financeira e fluxo de caixa';
                    } else if (page === 'relatorios') {
                        document.getElementById('relatoriosPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Relatórios';
                        document.getElementById('pageSubtitle').textContent = 'Estatísticas e análise de dados';
                        updateReports();
                    } else if (page === 'investimentos') {
                        document.getElementById('investimentosPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Investimentos';
                        document.getElementById('pageSubtitle').textContent = 'Dashboard do investidor';
                    } else if (page === 'planos') {
                        document.getElementById('planosPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Planos';
                        document.getElementById('pageSubtitle').textContent = 'Gestão de planos de assinatura';
                        updatePlans();
                    } else if (page === 'assinaturas') {
                        document.getElementById('assinaturasPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Assinaturas';
                        document.getElementById('pageSubtitle').textContent = 'Gestão de assinaturas ativas';
                        updateSubscriptions();
                    } else if (page === 'exportar') {
                        document.getElementById('exportarPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Importar/Exportar';
                        document.getElementById('pageSubtitle').textContent = 'Importação e exportação de dados';
                    } else if (page === 'stock') {
                        document.getElementById('stockPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Gestão de Stock';
                        document.getElementById('pageSubtitle').textContent = 'Controlo de stock e inventário';
                        updateStockPage();
                    } else if (page === 'fornecedores') {
                        document.getElementById('fornecedoresPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Fornecedores';
                        document.getElementById('pageSubtitle').textContent = 'Gestão de fornecedores';
                    } else if (page === 'encomendas') {
                        document.getElementById('encomendasPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Encomendas';
                        document.getElementById('pageSubtitle').textContent = 'Gestão de encomendas';
                    } else if (page === 'equipa') {
                        document.getElementById('equipaPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Equipa';
                        document.getElementById('pageSubtitle').textContent = 'Gestão da equipa';
                    } else if (page === 'configuracoes') {
                        document.getElementById('configuracoesPage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Configurações';
                        document.getElementById('pageSubtitle').textContent = 'Personalize o seu sistema';
                    } else if (page === 'suporte') {
                        document.getElementById('suportePage').style.display = 'block';
                        document.getElementById('pageTitle').textContent = 'Suporte';
                        document.getElementById('pageSubtitle').textContent = 'Ajuda e suporte técnico';
                    }
                });
            });
            
            // Tabs internas
            document.querySelectorAll('[data-client-tab], [data-product-tab], [data-sale-tab], [data-report-tab], [data-order-tab], [data-settings-tab], [data-subscription-tab], [data-import-export-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.getAttribute('data-client-tab') || 
                                   this.getAttribute('data-product-tab') || 
                                   this.getAttribute('data-sale-tab') || 
                                   this.getAttribute('data-report-tab') ||
                                   this.getAttribute('data-order-tab') ||
                                   this.getAttribute('data-settings-tab') ||
                                   this.getAttribute('data-subscription-tab') ||
                                   this.getAttribute('data-import-export-tab');
                    
                    // Remover active de todas as tabs do mesmo tipo
                    const selector = `[data-client-tab="${tabType}"], [data-product-tab="${tabType}"], [data-sale-tab="${tabType}"], [data-report-tab="${tabType}"], [data-order-tab="${tabType}"], [data-settings-tab="${tabType}"], [data-subscription-tab="${tabType}"], [data-import-export-tab="${tabType}"]`;
                    document.querySelectorAll(selector).forEach(t => {
                        t.parentNode.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                    });
                    
                    // Adicionar active à tab clicada
                    this.classList.add('active');
                    
                    // Mostrar conteúdo correspondente
                    const tabContents = this.closest('.content-box').querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    const contentId = tabType + 'Tab';
                    const contentElement = document.getElementById(contentId);
                    if (contentElement) {
                        contentElement.classList.add('active');
                    }
                });
            });
            
            // Botão novo cliente
            document.getElementById('novoClienteBtn').addEventListener('click', function() {
                document.getElementById('addClientForm').reset();
                showModal('addClientModal');
            });
            
            // Formulário adicionar cliente
            document.getElementById('addClientForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nextClientId = getNextId('client');
                const client = {
                    id: nextClientId,
                    name: document.getElementById('clientName').value,
                    phone: document.getElementById('clientPhone').value,
                    email: document.getElementById('clientEmail').value,
                    nif: document.getElementById('clientNIF').value,
                    address: document.getElementById('clientAddress').value,
                    type: document.getElementById('clientType').value,
                    notes: document.getElementById('clientNotes').value,
                    total_purchases: 0,
                    last_purchase: null,
                    created_at: new Date().toISOString().split('T')[0]
                };
                
                const clients = getClients();
                clients.push(client);
                saveClients(clients);
                saveNextId('client', nextClientId + 1);
                
                updateDashboard();
                updateClientsTable();
                closeModal('addClientModal');
                
                showAlert('Cliente adicionado com sucesso!', 'success');
            });
            
            // Botão novo produto
            document.getElementById('novoProdutoBtn').addEventListener('click', function() {
                document.getElementById('addProductForm').reset();
                document.getElementById('productCode').value = 'PROD' + getNextId('product').toString().padStart(3, '0');
                
                // Popular dropdown de fornecedores
                const suppliers = getSuppliers();
                const supplierSelect = document.getElementById('productSupplier');
                supplierSelect.innerHTML = '<option value="">Selecionar Fornecedor</option>';
                suppliers.forEach(supplier => {
                    const option = document.createElement('option');
                    option.value = supplier.id;
                    option.textContent = supplier.name;
                    supplierSelect.appendChild(option);
                });
                
                showModal('addProductModal');
            });
            
            // Formulário adicionar produto
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nextProductId = getNextId('product');
                const product = {
                    id: nextProductId,
                    code: document.getElementById('productCode').value,
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    cost: parseFloat(document.getElementById('productCost').value) || 0,
                    stock: parseInt(document.getElementById('productStock').value) || 0,
                    min_stock: parseInt(document.getElementById('productMinStock').value) || 10,
                    barcode: document.getElementById('productBarcode').value,
                    supplier: document.getElementById('productSupplier').value,
                    description: document.getElementById('productDescription').value
                };
                
                const products = getProducts();
                products.push(product);
                saveProducts(products);
                saveNextId('product', nextProductId + 1);
                
                updateDashboard();
                updateProductsTable();
                closeModal('addProductModal');
                
                showAlert('Produto adicionado com sucesso!', 'success');
            });
            
            // Botões nova venda
            document.getElementById('novaVendaBtn').addEventListener('click', function() {
                initSaleModal();
                showModal('newSaleModal');
            });
            
            document.getElementById('novaVendaModalBtn').addEventListener('click', function() {
                initSaleModal();
                showModal('newSaleModal');
            });
            
            document.getElementById('quickSaleBtn').addEventListener('click', function() {
                initSaleModal();
                showModal('newSaleModal');
            });
            
            // Botão finalizar venda
            document.getElementById('completeSaleBtn').addEventListener('click', completeSale);
            
            // Input valor recebido
            document.getElementById('saleAmountReceived').addEventListener('input', updateSaleSummary);
            
            // Botão notificações
            document.getElementById('notificationBtn').addEventListener('click', function() {
                showModal('notificationsModal');
            });
            
            // Alterar período de relatório
            document.getElementById('reportPeriod').addEventListener('change', updateReports);
            document.getElementById('chartPeriod').addEventListener('change', updateCharts);
            document.getElementById('investmentPeriod').addEventListener('change', function() {
                // Aqui você atualizaria os dados do dashboard de investimentos
                // baseado no período selecionado
            });
            
            // Botão novo plano
            document.getElementById('novoPlanoBtn').addEventListener('click', function() {
                document.getElementById('newPlanForm').reset();
                showModal('newPlanModal');
            });
            
            // Formulário novo plano
            document.getElementById('newPlanForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nextPlanId = getNextId('plan');
                const plan = {
                    id: nextPlanId,
                    name: document.getElementById('planName').value,
                    description: document.getElementById('planDescription').value,
                    price: parseFloat(document.getElementById('planPrice').value),
                    billing_cycle: document.getElementById('planBillingCycle').value,
                    features: [],
                    max_clients: parseInt(document.getElementById('planMaxClients').value) || 100,
                    max_products: parseInt(document.getElementById('planMaxProducts').value) || 500,
                    status: document.getElementById('planStatus').value,
                    trial_days: 7,
                    is_popular: false
                };
                
                // Adicionar features selecionadas
                if (document.getElementById('featureDashboard').checked) plan.features.push('dashboard');
                if (document.getElementById('featureClients').checked) plan.features.push('clientes');
                if (document.getElementById('featureProducts').checked) plan.features.push('produtos');
                if (document.getElementById('featureSales').checked) plan.features.push('vendas');
                if (document.getElementById('featureReports').checked) plan.features.push('relatorios_avancados');
                if (document.getElementById('featureExport').checked) plan.features.push('exportar');
                if (document.getElementById('featureImport').checked) plan.features.push('importar');
                if (document.getElementById('featureSupport').checked) plan.features.push('suporte_prioritario');
                
                const plans = getPlans();
                plans.push(plan);
                savePlans(plans);
                saveNextId('plan', nextPlanId + 1);
                
                updatePlans();
                closeModal('newPlanModal');
                
                showAlert('Plano criado com sucesso!', 'success');
            });
            
            // Botão nova assinatura
            document.getElementById('novaAssinaturaBtn').addEventListener('click', function() {
                document.getElementById('newSubscriptionForm').reset();
                
                // Popular dropdown de clientes
                const clients = getClients();
                const clientSelect = document.getElementById('subscriptionClient');
                clientSelect.innerHTML = '<option value="">Selecionar Cliente</option>';
                clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = `${client.name} (${client.phone})`;
                    clientSelect.appendChild(option);
                });
                
                // Popular dropdown de planos
                const plans = getPlans();
                const planSelect = document.getElementById('subscriptionPlan');
                planSelect.innerHTML = '<option value="">Selecionar Plano</option>';
                plans.forEach(plan => {
                    const option = document.createElement('option');
                    option.value = plan.id;
                    option.textContent = `${plan.name} - ${plan.price.toFixed(2)} MZN/mês`;
                    planSelect.appendChild(option);
                });
                
                // Definir data de início como hoje
                document.getElementById('subscriptionStartDate').value = new Date().toISOString().split('T')[0];
                
                showModal('newSubscriptionModal');
            });
            
            // Formulário nova assinatura
            document.getElementById('newSubscriptionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nextSubscriptionId = getNextId('subscription');
                const clientId = document.getElementById('subscriptionClient').value;
                const planId = document.getElementById('subscriptionPlan').value;
                
                const clients = getClients();
                const plans = getPlans();
                
                const client = clients.find(c => c.id == clientId);
                const plan = plans.find(p => p.id == planId);
                
                if (!client || !plan) {
                    showAlert('Cliente ou plano inválido!', 'danger');
                    return;
                }
                
                const startDate = new Date(document.getElementById('subscriptionStartDate').value);
                const trialDays = parseInt(document.getElementById('subscriptionTrialDays').value) || 0;
                const trialEnd = trialDays > 0 ? new Date(startDate.getTime() + trialDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : null;
                
                const subscription = {
                    id: nextSubscriptionId,
                    client_id: clientId,
                    client_name: client.name,
                    plan_id: planId,
                    plan_name: plan.name,
                    start_date: document.getElementById('subscriptionStartDate').value,
                    end_date: null, // Será calculado baseado no ciclo
                    next_payment: document.getElementById('subscriptionStartDate').value,
                    price: plan.price,
                    status: document.getElementById('subscriptionStatus').value,
                    payment_method: document.getElementById('subscriptionPaymentMethod').value,
                    trial_end: trialEnd,
                    auto_renew: document.getElementById('subscriptionAutoRenew').checked,
                    notes: document.getElementById('subscriptionNotes').value
                };
                
                // Calcular data de fim baseado no ciclo do plano
                const endDate = new Date(startDate);
                if (plan.billing_cycle === 'monthly') {
                    endDate.setMonth(endDate.getMonth() + 1);
                } else if (plan.billing_cycle === 'quarterly') {
                    endDate.setMonth(endDate.getMonth() + 3);
                } else if (plan.billing_cycle === 'semiannual') {
                    endDate.setMonth(endDate.getMonth() + 6);
                } else if (plan.billing_cycle === 'annual') {
                    endDate.setFullYear(endDate.getFullYear() + 1);
                }
                
                subscription.end_date = endDate.toISOString().split('T')[0];
                subscription.next_payment = subscription.end_date;
                
                const subscriptions = getSubscriptions();
                subscriptions.push(subscription);
                saveSubscriptions(subscriptions);
                saveNextId('subscription', nextSubscriptionId + 1);
                
                updateDashboard();
                updateSubscriptions();
                closeModal('newSubscriptionModal');
                
                showAlert('Assinatura criada com sucesso!', 'success');
            });
            
            // Formulário configurações de teste
            document.getElementById('trialSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const settings = getSettings();
                settings.trial_days = parseInt(document.getElementById('trialDays').value);
                settings.trial_max_clients = parseInt(document.getElementById('trialMaxClients').value);
                settings.trial_max_products = parseInt(document.getElementById('trialMaxProducts').value);
                settings.trial_max_sales = parseInt(document.getElementById('trialMaxSales').value);
                settings.trial_auto_cancel = document.getElementById('trialAutoCancel').checked;
                settings.trial_notifications = document.getElementById('trialNotifications').checked;
                settings.trial_card_required = document.getElementById('trialCardRequired').checked;
                
                // Obter features selecionadas
                const selectedFeatures = Array.from(document.getElementById('trialFeatures').selectedOptions).map(option => option.value);
                settings.trial_features = selectedFeatures;
                
                saveSettings(settings);
                showAlert('Configurações de teste atualizadas com sucesso!', 'success');
            });
            
            // Formulários de configurações
            document.getElementById('businessSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const settings = getSettings();
                settings.company_name = document.getElementById('companyName').value;
                settings.company_nif = document.getElementById('companyNIF').value;
                settings.company_address = document.getElementById('companyAddress').value;
                settings.company_phone = document.getElementById('companyPhone').value;
                settings.company_email = document.getElementById('companyEmail').value;
                settings.invoice_prefix = document.getElementById('invoicePrefix').value;
                settings.invoice_start_number = parseInt(document.getElementById('invoiceStartNumber').value);
                settings.invoice_footer = document.getElementById('invoiceFooter').value;
                settings.auto_print_invoice = document.getElementById('autoPrintInvoice').checked;
                
                saveSettings(settings);
                showAlert('Configurações da empresa guardadas!', 'success');
            });
            
            // Formulário configurações de assinatura
            document.getElementById('subscriptionSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const settings = getSubscriptionSettings();
                settings.currency = document.getElementById('subscriptionCurrency').value;
                settings.trial_period_days = parseInt(document.getElementById('trialPeriodDays').value);
                settings.grace_period_days = parseInt(document.getElementById('gracePeriodDays').value);
                settings.auto_renewal = document.getElementById('autoRenewal').value;
                settings.invoice_days_before = parseInt(document.getElementById('invoiceDaysBefore').value);
                settings.reminder_days = document.getElementById('reminderDays').value.split(',').map(d => parseInt(d.trim())).filter(d => !isNaN(d));
                
                // Métodos de pagamento
                settings.payment_methods = [];
                if (document.getElementById('paymentMulticaixa').checked) settings.payment_methods.push('Multicaixa');
                if (document.getElementById('paymentMPesa').checked) settings.payment_methods.push('M-Pesa');
                if (document.getElementById('paymentEMola').checked) settings.payment_methods.push('E-Mola');
                if (document.getElementById('paymentTransfer').checked) settings.payment_methods.push('Transferência');
                if (document.getElementById('paymentCard').checked) settings.payment_methods.push('Cartão');
                
                // Notificações
                settings.notify_trial_end = document.getElementById('notifyTrialEnd').checked;
                settings.notify_before_renewal = document.getElementById('notifyBeforeRenewal').checked;
                settings.notify_payment_failed = document.getElementById('notifyPaymentFailed').checked;
                settings.notify_subscription_end = document.getElementById('notifySubscriptionEnd').checked;
                settings.notify_auto_renewal = document.getElementById('notifyAutoRenewal').checked;
                settings.send_welcome_email = document.getElementById('sendWelcomeEmail').checked;
                
                saveSubscriptionSettings(settings);
                showAlert('Configurações de assinatura guardadas!', 'success');
            });
            
            document.getElementById('systemSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const settings = getSettings();
                settings.currency = document.getElementById('currency').value;
                settings.tax_rate = parseFloat(document.getElementById('taxRate').value);
                settings.low_stock_threshold = parseInt(document.getElementById('lowStockThreshold').value);
                settings.timezone = document.getElementById('timezone').value;
                settings.enable_stock_alerts = document.getElementById('enableStockAlerts').checked;
                settings.enable_sales_reports = document.getElementById('enableSalesReports').checked;
                settings.enable_client_birthday_alerts = document.getElementById('enableClientBirthdayAlerts').checked;
                settings.enable_auto_backup = document.getElementById('enableAutoBackup').checked;
                settings.backup_frequency = document.getElementById('backupFrequency').value;
                
                saveSettings(settings);
                showAlert('Configurações do sistema guardadas!', 'success');
            });
            
            // Carregar configurações nos formulários
            const settings = getSettings();
            const subscriptionSettings = getSubscriptionSettings();
            
            if (settings.company_name) {
                document.getElementById('companyName').value = settings.company_name || 'Bizz Flow Lda';
                document.getElementById('companyNIF').value = settings.company_nif || '';
                document.getElementById('companyAddress').value = settings.company_address || '';
                document.getElementById('companyPhone').value = settings.company_phone || '';
                document.getElementById('companyEmail').value = settings.company_email || '';
                document.getElementById('invoicePrefix').value = settings.invoice_prefix || 'FAT';
                document.getElementById('invoiceStartNumber').value = settings.invoice_start_number || 1001;
                document.getElementById('invoiceFooter').value = settings.invoice_footer || 'Obrigado pela sua preferência!';
                document.getElementById('autoPrintInvoice').checked = settings.auto_print_invoice !== false;
                
                document.getElementById('currency').value = settings.currency || 'MZN';
                                document.getElementById('taxRate').value = settings.tax_rate || 17;
                document.getElementById('lowStockThreshold').value = settings.low_stock_threshold || 10;
                document.getElementById('timezone').value = settings.timezone || 'Africa/Maputo';
                document.getElementById('enableStockAlerts').checked = settings.enable_stock_alerts !== false;
                document.getElementById('enableSalesReports').checked = settings.enable_sales_reports !== false;
                document.getElementById('enableClientBirthdayAlerts').checked = settings.enable_client_birthday_alerts !== false;
                document.getElementById('enableAutoBackup').checked = settings.enable_auto_backup !== false;
                document.getElementById('backupFrequency').value = settings.backup_frequency || 'weekly';
            }
            
            if (subscriptionSettings.currency) {
                document.getElementById('subscriptionCurrency').value = subscriptionSettings.currency || 'MZN';
                document.getElementById('trialPeriodDays').value = subscriptionSettings.trial_period_days || 7;
                document.getElementById('gracePeriodDays').value = subscriptionSettings.grace_period_days || 3;
                document.getElementById('autoRenewal').value = subscriptionSettings.auto_renewal || 'enabled';
                document.getElementById('invoiceDaysBefore').value = subscriptionSettings.invoice_days_before || 7;
                document.getElementById('reminderDays').value = subscriptionSettings.reminder_days ? subscriptionSettings.reminder_days.join(', ') : '7, 3, 1';
                
                if (subscriptionSettings.payment_methods) {
                    document.getElementById('paymentMulticaixa').checked = subscriptionSettings.payment_methods.includes('Multicaixa');
                    document.getElementById('paymentMPesa').checked = subscriptionSettings.payment_methods.includes('M-Pesa');
                    document.getElementById('paymentEMola').checked = subscriptionSettings.payment_methods.includes('E-Mola');
                    document.getElementById('paymentTransfer').checked = subscriptionSettings.payment_methods.includes('Transferência');
                    document.getElementById('paymentCard').checked = subscriptionSettings.payment_methods.includes('Cartão');
                }
                
                document.getElementById('notifyTrialEnd').checked = subscriptionSettings.notify_trial_end !== false;
                document.getElementById('notifyBeforeRenewal').checked = subscriptionSettings.notify_before_renewal !== false;
                document.getElementById('notifyPaymentFailed').checked = subscriptionSettings.notify_payment_failed !== false;
                document.getElementById('notifySubscriptionEnd').checked = subscriptionSettings.notify_subscription_end !== false;
                document.getElementById('notifyAutoRenewal').checked = subscriptionSettings.notify_auto_renewal !== false;
                document.getElementById('sendWelcomeEmail').checked = subscriptionSettings.send_welcome_email !== false;
            }
            
                    // Botão repor stock
        document.getElementById('reporStockBtn').addEventListener('click', function() {
            initStockEntryModal();
            showModal('stockEntryModal');
        });
        
        // Botões de stock
        document.getElementById('novaEntradaBtn').addEventListener('click', function() {
            initStockEntryModal();
            showModal('stockEntryModal');
        });
        
        document.getElementById('novaSaidaBtn').addEventListener('click', function() {
            initStockOutputModal();
            showModal('stockOutputModal');
        });
        
        // Formulário entrada de stock
        document.getElementById('stockEntryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nextMovementId = getNextId('stock_movement');
            const productId = document.getElementById('stockEntryProduct').value;
            const quantity = parseInt(document.getElementById('stockEntryQuantity').value);
            const unitCost = parseFloat(document.getElementById('stockEntryUnitCost').value) || 0;
            const supplierId = document.getElementById('stockEntrySupplier').value;
            
            const products = getProducts();
            const product = products.find(function(p) { return p.id == productId; });
            
            if (!product) {
                showAlert('Produto não encontrado!', 'danger');
                return;
            }
            
            // Atualizar stock do produto
            product.stock += quantity;
            
            if (unitCost > 0 && product.cost === 0) {
                product.cost = unitCost;
            }
            
            saveProducts(products);
            
            // Registrar movimentação
            const movement = {
                id: nextMovementId,
                product_id: productId,
                product_name: product.name,
                type: 'entrada',
                quantity: quantity,
                unit_cost: unitCost,
                total_cost: quantity * unitCost,
                supplier_id: supplierId,
                supplier_name: '',
                date: new Date().toISOString().split('T')[0],
                responsible: document.getElementById('currentUserName').textContent,
                notes: document.getElementById('stockEntryNotes').value
            };
            
            // Obter nome do fornecedor
            if (supplierId) {
                const suppliers = getSuppliers();
                const supplier = suppliers.find(function(s) { return s.id == supplierId; });
                if (supplier) {
                    movement.supplier_name = supplier.name;
                }
            }
            
            const movements = getStockMovements();
            movements.push(movement);
            saveStockMovements(movements);
            saveNextId('stock_movement', nextMovementId + 1);
            
            // Atualizar dados financeiros
            const financial = getFinancial();
            financial.monthly_expenses += movement.total_cost;
            financial.current_balance -= movement.total_cost;
            financial.monthly_profit = financial.monthly_income - financial.monthly_expenses;
            saveFinancial(financial);
            
            updateDashboard();
            updateProductsTable();
            updateStockPage();
            closeModal('stockEntryModal');
            
            showAlert('Entrada de ' + quantity + ' unidades de ' + product.name + ' registada com sucesso!', 'success');
        });
        
        // Formulário saída de stock
        document.getElementById('stockOutputForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nextMovementId = getNextId('stock_movement');
            const productId = document.getElementById('stockOutputProduct').value;
            const quantity = parseInt(document.getElementById('stockOutputQuantity').value);
            const reason = document.getElementById('stockOutputReason').value;
            const clientId = document.getElementById('stockOutputClient').value;
            
            const products = getProducts();
            const product = products.find(function(p) { return p.id == productId; });
            
            if (!product) {
                showAlert('Produto não encontrado!', 'danger');
                return;
            }
            
            if (product.stock < quantity) {
                showAlert('Stock insuficiente! Disponível: ' + product.stock + ' unidades', 'danger');
                return;
            }
            
            // Atualizar stock do produto
            product.stock -= quantity;
            saveProducts(products);
            
            // Registrar movimentação
            const movement = {
                id: nextMovementId,
                product_id: productId,
                product_name: product.name,
                type: 'saida',
                quantity: quantity,
                reason: reason,
                client_id: clientId,
                client_name: '',
                date: new Date().toISOString().split('T')[0],
                responsible: document.getElementById('currentUserName').textContent,
                notes: document.getElementById('stockOutputNotes').value
            };
            
            // Obter nome do cliente
            if (clientId) {
                const clients = getClients();
                const client = clients.find(function(c) { return c.id == clientId; });
                if (client) {
                    movement.client_name = client.name;
                }
            }
            
            const movements = getStockMovements();
            movements.push(movement);
            saveStockMovements(movements);
            saveNextId('stock_movement', nextMovementId + 1);
            
            updateDashboard();
            updateProductsTable();
            updateStockPage();
            closeModal('stockOutputModal');
            
            showAlert('Saída de ' + quantity + ' unidades de ' + product.name + ' registada com sucesso!', 'success');
        });
        
        // Botão ajuda
        document.getElementById('helpBtn').addEventListener('click', function() {
            document.querySelectorAll('.menu-item').forEach(function(i) {
                i.classList.remove('active');
            });
            document.querySelector('[data-page="suporte"]').classList.add('active');
            
            document.querySelectorAll('.page-content').forEach(function(p) {
                p.style.display = 'none';
            });
            document.getElementById('suportePage').style.display = 'block';
            
            document.getElementById('pageTitle').textContent = 'Suporte';
            document.getElementById('pageSubtitle').textContent = 'Ajuda e suporte técnico';
        });
        
        // Função para adicionar produto à venda
        function addToSale(product) {
            if (!window.currentSaleItems) {
                window.currentSaleItems = [];
            }
            
            // Verificar se produto já está na venda
            const existingItemIndex = window.currentSaleItems.findIndex(function(item) {
                return item.id === product.id;
            });
            
            if (existingItemIndex > -1) {
                // Aumentar quantidade
                window.currentSaleItems[existingItemIndex].quantity++;
            } else {
                // Adicionar novo item
                window.currentSaleItems.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    total: product.price
                });
            }
            
            updateSaleItemsList();
            updateSaleSummary();
        }
        
        // Função para atualizar lista de itens da venda
        function updateSaleItemsList() {
            const saleItemsList = document.getElementById('saleItemsList');
            if (!saleItemsList) return;
            
            saleItemsList.innerHTML = '';
            
            if (!window.currentSaleItems || window.currentSaleItems.length === 0) {
                saleItemsList.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #666;">Nenhum item adicionado à venda</td></tr>';
                return;
            }
            
            window.currentSaleItems.forEach(function(item, index) {
                const row = document.createElement('tr');
                row.innerHTML = 
                    '<td>' + item.name + '</td>' +
                    '<td>' +
                        '<div style="display: flex; align-items: center; gap: 5px;">' +
                            '<button class="btn btn-sm btn-outline" onclick="changeItemQuantity(' + index + ', -1)" style="padding: 2px 8px;">-</button>' +
                            '<input type="number" value="' + item.quantity + '" min="1" style="width: 60px; text-align: center;" onchange="updateItemQuantity(' + index + ', this.value)">' +
                            '<button class="btn btn-sm btn-outline" onclick="changeItemQuantity(' + index + ', 1)" style="padding: 2px 8px;">+</button>' +
                        '</div>' +
                    '</td>' +
                    '<td>' + item.price.toFixed(2) + ' MZN</td>' +
                    '<td>' + (item.price * item.quantity).toFixed(2) + ' MZN</td>' +
                    '<td>' +
                        '<button class="btn btn-sm btn-danger" onclick="removeSaleItem(' + index + ')" style="padding: 2px 8px;">' +
                            '<i class="fas fa-trash"></i>' +
                        '</button>' +
                    '</td>';
                saleItemsList.appendChild(row);
            });
        }
        
        // Função para atualizar resumo da venda
        function updateSaleSummary() {
            if (!window.currentSaleItems) {
                window.currentSaleItems = [];
            }
            
            const subtotal = window.currentSaleItems.reduce(function(sum, item) {
                return sum + (item.price * item.quantity);
            }, 0);
            
            const taxRate = parseFloat(getSettings().tax_rate) || 17;
            const discount = 0; // Poderia ser calculado com base em promoções
            const tax = (subtotal - discount) * (taxRate / 100);
            const total = (subtotal - discount) + tax;
            
            const amountReceived = parseFloat(document.getElementById('saleAmountReceived').value) || 0;
            const change = amountReceived - total > 0 ? amountReceived - total : 0;
            
            document.getElementById('saleSubtotal').textContent = subtotal.toFixed(2) + ' MZN';
            document.getElementById('saleDiscount').textContent = discount.toFixed(2) + ' MZN';
            document.getElementById('saleTax').textContent = tax.toFixed(2) + ' MZN';
            document.getElementById('saleTotal').textContent = total.toFixed(2) + ' MZN';
            document.getElementById('saleChange').textContent = change.toFixed(2) + ' MZN';
            document.getElementById('saleChange').style.color = change > 0 ? '#27ae60' : '#e74c3c';
        }
        
        // Funções auxiliares para gestão de itens da venda
        function changeItemQuantity(index, delta) {
            if (window.currentSaleItems && window.currentSaleItems[index]) {
                const newQuantity = window.currentSaleItems[index].quantity + delta;
                if (newQuantity >= 1) {
                    window.currentSaleItems[index].quantity = newQuantity;
                    updateSaleItemsList();
                    updateSaleSummary();
                }
            }
        }
        
        function updateItemQuantity(index, newQuantity) {
            if (window.currentSaleItems && window.currentSaleItems[index]) {
                const quantity = parseInt(newQuantity);
                if (quantity >= 1) {
                    window.currentSaleItems[index].quantity = quantity;
                    updateSaleItemsList();
                    updateSaleSummary();
                }
            }
        }
        
        function removeSaleItem(index) {
            if (window.currentSaleItems) {
                window.currentSaleItems.splice(index, 1);
                updateSaleItemsList();
                updateSaleSummary();
            }
        }
        
        // Função para completar a venda
        function completeSale() {
            if (!window.currentSaleItems || window.currentSaleItems.length === 0) {
                showAlert('Adicione produtos à venda primeiro!', 'danger');
                return;
            }
            
            const clientId = document.getElementById('saleClient').value;
            const paymentMethod = document.getElementById('salePaymentMethod').value;
            const amountReceived = parseFloat(document.getElementById('saleAmountReceived').value) || 0;
            
            const subtotal = window.currentSaleItems.reduce(function(sum, item) {
                return sum + (item.price * item.quantity);
            }, 0);
            
            const taxRate = parseFloat(getSettings().tax_rate) || 17;
            const discount = 0;
            const tax = (subtotal - discount) * (taxRate / 100);
            const total = (subtotal - discount) + tax;
            
            if (amountReceived < total) {
                showAlert('Valor recebido insuficiente! Total: ' + total.toFixed(2) + ' MZN', 'danger');
                return;
            }
            
            // Obter próximo ID de venda
            const nextSaleId = getNextId('sale');
            
            // Obter cliente
            let clientName = 'Cliente Avulso';
            if (clientId) {
                const clients = getClients();
                const client = clients.find(function(c) { return c.id == clientId; });
                if (client) {
                    clientName = client.name;
                    
                    // Atualizar total de compras do cliente
                    client.total_purchases = (client.total_purchases || 0) + total;
                    client.last_purchase = new Date().toISOString().split('T')[0];
                    saveClients(clients);
                }
            }
            
            // Criar venda
            const sale = {
                id: nextSaleId,
                receipt_no: 'REC' + nextSaleId.toString().padStart(3, '0'),
                client_id: clientId || null,
                client_name: clientName,
                items: window.currentSaleItems.map(function(item) {
                    return {
                        product_id: item.id,
                        name: item.name,
                        quantity: item.quantity,
                        price: item.price,
                        total: item.price * item.quantity
                    };
                }),
                subtotal: subtotal,
                discount: discount,
                tax: tax,
                total: total,
                payment_method: paymentMethod,
                amount_received: amountReceived,
                change: amountReceived - total,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().split(' ')[0].substring(0, 5),
                seller: document.getElementById('currentUserName').textContent || 'Sistema'
            };
            
            // Atualizar stock dos produtos
            const products = getProducts();
            window.currentSaleItems.forEach(function(saleItem) {
                const product = products.find(function(p) { return p.id === saleItem.id; });
                if (product) {
                    product.stock -= saleItem.quantity;
                    if (product.stock < 0) product.stock = 0;
                }
            });
            saveProducts(products);
            
            // Registrar movimentações de stock
            const nextMovementId = getNextId('stock_movement');
            const movements = getStockMovements();
            
            window.currentSaleItems.forEach(function(saleItem, index) {
                const product = products.find(function(p) { return p.id === saleItem.id; });
                if (product) {
                    const movement = {
                        id: nextMovementId + index,
                        product_id: saleItem.id,
                        product_name: product.name,
                        type: 'saida',
                        quantity: saleItem.quantity,
                        reason: 'venda',
                        client_id: clientId || null,
                        client_name: clientName,
                        date: sale.date,
                        responsible: sale.seller,
                        notes: 'Venda ' + sale.receipt_no
                    };
                    movements.push(movement);
                }
            });
            
            saveStockMovements(movements);
            saveNextId('stock_movement', nextMovementId + window.currentSaleItems.length);
            
            // Salvar venda
            const sales = getSales();
            sales.push(sale);
            saveSales(sales);
            saveNextId('sale', nextSaleId + 1);
            
            // Atualizar dados financeiros
            const financial = getFinancial();
            financial.monthly_income += total;
            financial.current_balance += total;
            financial.monthly_profit = financial.monthly_income - financial.monthly_expenses;
            saveFinancial(financial);
            
            // Atualizar dados de investimentos
            const investments = getInvestments();
            investments.roi_percentage = ((financial.monthly_income / investments.total_invested) * 100).toFixed(1);
            investments.profit_margin = ((financial.monthly_profit / financial.monthly_income) * 100).toFixed(1);
            saveInvestments(investments);
            
            // Limpar venda atual
            window.currentSaleItems = [];
            
            // Fechar modal e atualizar dados
            closeModal('newSaleModal');
            updateDashboard();
            updateSalesTable();
            updateProductsTable();
            updateClientsTable();
            updateStockPage();
            
            // Gerar recibo
            generateReceipt(sale);
            
            showAlert('Venda ' + sale.receipt_no + ' concluída com sucesso! Total: ' + total.toFixed(2) + ' MZN', 'success');
        }
        
        // Função para gerar recibo
        function generateReceipt(sale) {
            const settings = getSettings();
            
            let receiptContent = '';
            receiptContent += '<html>';
            receiptContent += '<head>';
            receiptContent += '<title>Recibo ' + sale.receipt_no + '</title>';
            receiptContent += '<style>';
            receiptContent += 'body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }';
            receiptContent += '.header { text-align: center; margin-bottom: 20px; }';
            receiptContent += '.company-name { font-size: 24px; font-weight: bold; color: #1a5f7a; }';
            receiptContent += '.receipt-info { margin-bottom: 20px; }';
            receiptContent += '.items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }';
            receiptContent += '.items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }';
            receiptContent += '.items-table th { background-color: #f2f2f2; }';
            receiptContent += '.total { font-size: 18px; font-weight: bold; text-align: right; }';
            receiptContent += '.footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }';
            receiptContent += '</style>';
            receiptContent += '</head>';
            receiptContent += '<body>';
            
            receiptContent += '<div class="header">';
            receiptContent += '<div class="company-name">' + (settings.company_name || 'Bizz Flow CRM') + '</div>';
            receiptContent += '<div>' + (settings.company_address || '') + '</div>';
            receiptContent += '<div>NIF: ' + (settings.company_nif || '') + ' | Tel: ' + (settings.company_phone || '') + '</div>';
            receiptContent += '</div>';
            
            receiptContent += '<div class="receipt-info">';
            receiptContent += '<div><strong>RECIBO:</strong> ' + sale.receipt_no + '</div>';
            receiptContent += '<div><strong>DATA:</strong> ' + sale.date + ' ' + sale.time + '</div>';
            receiptContent += '<div><strong>CLIENTE:</strong> ' + sale.client_name + '</div>';
            receiptContent += '<div><strong>ATENDENTE:</strong> ' + sale.seller + '</div>';
            receiptContent += '</div>';
            
            receiptContent += '<table class="items-table">';
            receiptContent += '<thead>';
            receiptContent += '<tr>';
            receiptContent += '<th>Produto</th>';
            receiptContent += '<th>Qtd</th>';
            receiptContent += '<th>Preço</th>';
            receiptContent += '<th>Total</th>';
            receiptContent += '</tr>';
            receiptContent += '</thead>';
            receiptContent += '<tbody>';
            
            sale.items.forEach(function(item) {
                receiptContent += '<tr>';
                receiptContent += '<td>' + item.name + '</td>';
                receiptContent += '<td>' + item.quantity + '</td>';
                receiptContent += '<td>' + item.price.toFixed(2) + ' MZN</td>';
                receiptContent += '<td>' + item.total.toFixed(2) + ' MZN</td>';
                receiptContent += '</tr>';
            });
            
            receiptContent += '</tbody>';
            receiptContent += '</table>';
            
            receiptContent += '<div style="text-align: right;">';
            receiptContent += '<div>Subtotal: ' + sale.subtotal.toFixed(2) + ' MZN</div>';
            
            if (sale.discount > 0) {
                receiptContent += '<div>Desconto: -' + sale.discount.toFixed(2) + ' MZN</div>';
            }
            
            receiptContent += '<div>IVA (' + (getSettings().tax_rate || 17) + '%): ' + sale.tax.toFixed(2) + ' MZN</div>';
            receiptContent += '<div class="total">TOTAL: ' + sale.total.toFixed(2) + ' MZN</div>';
            receiptContent += '<div>Recebido: ' + sale.amount_received.toFixed(2) + ' MZN</div>';
            receiptContent += '<div>Troco: ' + sale.change.toFixed(2) + ' MZN</div>';
            receiptContent += '<div>Forma de Pagamento: ' + sale.payment_method + '</div>';
            receiptContent += '</div>';
            
            receiptContent += '<div class="footer">';
            receiptContent += (settings.invoice_footer || 'Obrigado pela sua preferência!');
            receiptContent += '<br><br>';
            receiptContent += 'Este documento foi gerado electronicamente pelo Bizz Flow CRM';
            receiptContent += '</div>';
            
            receiptContent += '</body>';
            receiptContent += '</html>';
            
            // Abrir recibo em nova janela para impressão
            const printWindow = window.open('', '_blank');
            printWindow.document.write(receiptContent);
            printWindow.document.close();
            
            // Se a configuração de impressão automática estiver ativada
            if (settings.auto_print_invoice !== false) {
                printWindow.print();
            }
        }
        
        // Função para ver detalhes da venda
        function viewSale(saleId) {
            const sales = getSales();
            const sale = sales.find(function(s) { return s.id === saleId; });
            
            if (!sale) {
                showAlert('Venda não encontrada!', 'danger');
                return;
            }
            
            let saleDetails = '';
            saleDetails += '<div style="padding: 20px;">';
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-bottom: 20px;">';
            saleDetails += '<div>';
            saleDetails += '<h3 style="color: var(--bizzflow-primary); margin-bottom: 5px;">Recibo ' + sale.receipt_no + '</h3>';
            saleDetails += '<p style="color: var(--bizzflow-gray);">' + sale.date + ' ' + sale.time + '</p>';
            saleDetails += '</div>';
            saleDetails += '<span class="badge badge-success" style="height: fit-content;">Concluída</span>';
            saleDetails += '</div>';
            
            saleDetails += '<div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">';
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
            saleDetails += '<span>Cliente:</span>';
            saleDetails += '<span style="font-weight: 600;">' + sale.client_name + '</span>';
            saleDetails += '</div>';
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
            saleDetails += '<span>Atendente:</span>';
            saleDetails += '<span>' + sale.seller + '</span>';
            saleDetails += '</div>';
            saleDetails += '<div style="display: flex; justify-content: space-between;">';
            saleDetails += '<span>Forma de Pagamento:</span>';
            saleDetails += '<span>' + sale.payment_method + '</span>';
            saleDetails += '</div>';
            saleDetails += '</div>';
            
            saleDetails += '<h4 style="margin-bottom: 15px; color: var(--bizzflow-dark);">Itens da Venda</h4>';
            saleDetails += '<div class="table-container">';
            saleDetails += '<table style="min-width: auto;">';
            saleDetails += '<thead>';
            saleDetails += '<tr>';
            saleDetails += '<th>Produto</th>';
            saleDetails += '<th>Qtd</th>';
            saleDetails += '<th>Preço Unit.</th>';
            saleDetails += '<th>Total</th>';
            saleDetails += '</tr>';
            saleDetails += '</thead>';
            saleDetails += '<tbody>';
            
            sale.items.forEach(function(item) {
                saleDetails += '<tr>';
                saleDetails += '<td>' + item.name + '</td>';
                saleDetails += '<td>' + item.quantity + '</td>';
                saleDetails += '<td>' + item.price.toFixed(2) + ' MZN</td>';
                saleDetails += '<td>' + item.total.toFixed(2) + ' MZN</td>';
                saleDetails += '</tr>';
            });
            
            saleDetails += '</tbody>';
            saleDetails += '</table>';
            saleDetails += '</div>';
            
            saleDetails += '<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">';
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-bottom: 10px;">';
            saleDetails += '<span>Subtotal:</span>';
            saleDetails += '<span>' + sale.subtotal.toFixed(2) + ' MZN</span>';
            saleDetails += '</div>';
            
            if (sale.discount > 0) {
                saleDetails += '<div style="display: flex; justify-content: space-between; margin-bottom: 10px;">';
                saleDetails += '<span>Desconto:</span>';
                saleDetails += '<span>- ' + sale.discount.toFixed(2) + ' MZN</span>';
                saleDetails += '</div>';
            }
            
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-bottom: 10px;">';
            saleDetails += '<span>IVA:</span>';
            saleDetails += '<span>' + sale.tax.toFixed(2) + ' MZN</span>';
            saleDetails += '</div>';
            
            saleDetails += '<div style="display: flex; justify-content: space-between; font-size: 1.3rem; font-weight: bold; padding-top: 10px; border-top: 1px solid #ddd;">';
            saleDetails += '<span>Total:</span>';
            saleDetails += '<span>' + sale.total.toFixed(2) + ' MZN</span>';
            saleDetails += '</div>';
            
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-top: 10px;">';
            saleDetails += '<span>Valor Recebido:</span>';
            saleDetails += '<span>' + sale.amount_received.toFixed(2) + ' MZN</span>';
            saleDetails += '</div>';
            
            saleDetails += '<div style="display: flex; justify-content: space-between; margin-top: 5px;">';
            saleDetails += '<span>Troco:</span>';
            saleDetails += '<span style="color: #27ae60; font-weight: 600;">' + sale.change.toFixed(2) + ' MZN</span>';
            saleDetails += '</div>';
            saleDetails += '</div>';
            
            saleDetails += '<div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">';
            saleDetails += '<button class="btn btn-primary" onclick="generateReceipt(' + saleId + ')">';
            saleDetails += '<i class="fas fa-print"></i> Imprimir Recibo';
            saleDetails += '</button>';
            saleDetails += '</div>';
            saleDetails += '</div>';
            
            document.getElementById('saleDetailsContent').innerHTML = saleDetails;
            showModal('viewSaleModal');
        }
        
        // Funções de edição/exclusão
        function editClient(clientId) {
            const clients = getClients();
            const client = clients.find(function(c) { return c.id === clientId; });
            
            if (client) {
                document.getElementById('clientName').value = client.name;
                document.getElementById('clientPhone').value = client.phone;
                document.getElementById('clientEmail').value = client.email || '';
                document.getElementById('clientNIF').value = client.nif || '';
                document.getElementById('clientAddress').value = client.address || '';
                document.getElementById('clientType').value = client.type || 'regular';
                document.getElementById('clientNotes').value = client.notes || '';
                
                showModal('addClientModal');
                
                // Modificar o formulário para atualizar em vez de criar novo
                const form = document.getElementById('addClientForm');
                const originalSubmit = form.onsubmit;
                
                form.onsubmit = function(e) {
                    e.preventDefault();
                    
                    client.name = document.getElementById('clientName').value;
                    client.phone = document.getElementById('clientPhone').value;
                    client.email = document.getElementById('clientEmail').value;
                    client.nif = document.getElementById('clientNIF').value;
                    client.address = document.getElementById('clientAddress').value;
                    client.type = document.getElementById('clientType').value;
                    client.notes = document.getElementById('clientNotes').value;
                    
                    saveClients(clients);
                    updateDashboard();
                    updateClientsTable();
                    closeModal('addClientModal');
                    
                    showAlert('Cliente atualizado com sucesso!', 'success');
                    
                    // Restaurar o comportamento original do formulário
                    form.onsubmit = originalSubmit;
                };
            }
        }
        
        function deleteClient(clientId) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                const clients = getClients();
                const filteredClients = clients.filter(function(c) { return c.id !== clientId; });
                saveClients(filteredClients);
                
                updateDashboard();
                updateClientsTable();
                
                showAlert('Cliente excluído com sucesso!', 'success');
            }
        }
        
        function editProduct(productId) {
            const products = getProducts();
            const product = products.find(function(p) { return p.id === productId; });
            
            if (product) {
                document.getElementById('productCode').value = product.code;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productCost').value = product.cost || '';
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productMinStock').value = product.min_stock;
                document.getElementById('productBarcode').value = product.barcode || '';
                document.getElementById('productDescription').value = product.description || '';
                
                // Popular dropdown de fornecedores
                const suppliers = getSuppliers();
                const supplierSelect = document.getElementById('productSupplier');
                supplierSelect.innerHTML = '<option value="">Selecionar Fornecedor</option>';
                suppliers.forEach(function(supplier) {
                    const option = document.createElement('option');
                    option.value = supplier.id;
                    option.textContent = supplier.name;
                    if (product.supplier == supplier.id) {
                        option.selected = true;
                    }
                    supplierSelect.appendChild(option);
                });
                
                showModal('addProductModal');
                
                // Modificar o formulário para atualizar em vez de criar novo
                const form = document.getElementById('addProductForm');
                const originalSubmit = form.onsubmit;
                
                form.onsubmit = function(e) {
                    e.preventDefault();
                    
                    product.code = document.getElementById('productCode').value;
                    product.name = document.getElementById('productName').value;
                    product.category = document.getElementById('productCategory').value;
                    product.price = parseFloat(document.getElementById('productPrice').value);
                    product.cost = parseFloat(document.getElementById('productCost').value) || 0;
                    product.stock = parseInt(document.getElementById('productStock').value) || 0;
                    product.min_stock = parseInt(document.getElementById('productMinStock').value) || 10;
                    product.barcode = document.getElementById('productBarcode').value;
                    product.supplier = document.getElementById('productSupplier').value;
                    product.description = document.getElementById('productDescription').value;
                    
                    saveProducts(products);
                    updateDashboard();
                    updateProductsTable();
                    updateStockPage();
                    closeModal('addProductModal');
                    
                    showAlert('Produto atualizado com sucesso!', 'success');
                    
                    // Restaurar o comportamento original do formulário
                    form.onsubmit = originalSubmit;
                };
            }
        }
        
        function deleteProduct(productId) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                const products = getProducts();
                const filteredProducts = products.filter(function(p) { return p.id !== productId; });
                saveProducts(filteredProducts);
                
                updateDashboard();
                updateProductsTable();
                updateStockPage();
                
                showAlert('Produto excluído com sucesso!', 'success');
            }
        }
        
        function deleteSale(saleId) {
            if (confirm('Tem certeza que deseja excluir esta venda?')) {
                const sales = getSales();
                const sale = sales.find(function(s) { return s.id === saleId; });
                const filteredSales = sales.filter(function(s) { return s.id !== saleId; });
                
                if (sale) {
                    // Reverter stock dos produtos
                    const products = getProducts();
                    sale.items.forEach(function(saleItem) {
                        const product = products.find(function(p) { return p.id === saleItem.product_id; });
                        if (product) {
                            product.stock += saleItem.quantity;
                        }
                    });
                    saveProducts(products);
                    
                    // Atualizar dados financeiros
                    const financial = getFinancial();
                    financial.monthly_income -= sale.total;
                    financial.current_balance -= sale.total;
                    financial.monthly_profit = financial.monthly_income - financial.monthly_expenses;
                    saveFinancial(financial);
                    
                    // Atualizar dados do cliente
                    if (sale.client_id) {
                        const clients = getClients();
                        const client = clients.find(function(c) { return c.id === sale.client_id; });
                        if (client) {
                            client.total_purchases -= sale.total;
                            if (client.total_purchases < 0) client.total_purchases = 0;
                            saveClients(clients);
                        }
                    }
                }
                
                saveSales(filteredSales);
                
                updateDashboard();
                updateSalesTable();
                updateProductsTable();
                updateClientsTable();
                
                showAlert('Venda excluída com sucesso!', 'success');
            }
        }
        
        function editPlan(planId) {
            const plans = getPlans();
            const plan = plans.find(function(p) { return p.id === planId; });
            
            if (plan) {
                showAlert('Funcionalidade de edição de planos em desenvolvimento!', 'info');
            }
        }
        
        function deletePlan(planId) {
            if (confirm('Tem certeza que deseja excluir este plano?')) {
                const plans = getPlans();
                const filteredPlans = plans.filter(function(p) { return p.id !== planId; });
                savePlans(filteredPlans);
                
                updatePlans();
                
                showAlert('Plano excluído com sucesso!', 'success');
            }
        }
        
        function editSubscription(subscriptionId) {
            const subscriptions = getSubscriptions();
            const subscription = subscriptions.find(function(s) { return s.id === subscriptionId; });
            
            if (subscription) {
                showAlert('Funcionalidade de edição de assinaturas em desenvolvimento!', 'info');
            }
        }
        
        function deleteSubscription(subscriptionId) {
            if (confirm('Tem certeza que deseja excluir esta assinatura?')) {
                const subscriptions = getSubscriptions();
                const filteredSubscriptions = subscriptions.filter(function(s) { return s.id !== subscriptionId; });
                saveSubscriptions(filteredSubscriptions);
                
                updateDashboard();
                updateSubscriptions();
                
                showAlert('Assinatura excluída com sucesso!', 'success');
            }
        }
        
        // Função para mostrar alertas
        function showAlert(message, type) {
            // Remover alertas existentes
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(function(alert) {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            });
            
            // Criar novo alerta
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-' + type;
            alertDiv.innerHTML = 
                '<i class="fas fa-' + 
                (type === 'success' ? 'check-circle' : 
                 type === 'warning' ? 'exclamation-triangle' : 
                 type === 'danger' ? 'times-circle' : 'info-circle') + 
                '"></i>' +
                '<div>' + message + '</div>';
            
            // Adicionar ao dashboard
            const dashboardPage = document.getElementById('dashboardPage');
            if (dashboardPage && dashboardPage.style.display !== 'none') {
                dashboardPage.insertBefore(alertDiv, dashboardPage.firstChild);
            } else {
                // Adicionar ao topo da página atual
                const currentPage = document.querySelector('.page-content[style*="block"]');
                if (currentPage) {
                    currentPage.insertBefore(alertDiv, currentPage.firstChild);
                }
            }
            
            // Remover alerta após 5 segundos
            setTimeout(function() {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }
        
        // Função para gerar relatório personalizado
        function generateCustomReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            
            let startDate, endDate;
            
            if (dateRange === 'custom') {
                startDate = document.getElementById('startDate').value;
                endDate = document.getElementById('endDate').value;
                
                if (!startDate || !endDate) {
                    showAlert('Por favor, selecione as datas inicial e final!', 'danger');
                    return;
                }
            } else {
                const now = new Date();
                endDate = new Date().toISOString().split('T')[0];
                
                switch(dateRange) {
                    case 'today':
                        startDate = endDate;
                        break;
                    case 'week':
                        const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
                        startDate = weekAgo.toISOString().split('T')[0];
                        break;
                    case 'month':
                        const monthAgo = new Date();
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        startDate = monthAgo.toISOString().split('T')[0];
                        break;
                    case 'quarter':
                        const quarterAgo = new Date();
                        quarterAgo.setMonth(quarterAgo.getMonth() - 3);
                        startDate = quarterAgo.toISOString().split('T')[0];
                        break;
                    case 'year':
                        const yearAgo = new Date();
                        yearAgo.setFullYear(yearAgo.getFullYear() - 1);
                        startDate = yearAgo.toISOString().split('T')[0];
                        break;
                }
            }
            
            // Criar elementos DOM (sem problemas de escape)
            const resultsDiv = document.getElementById('customReportResults');
            if (resultsDiv) {
                resultsDiv.innerHTML = ''; // Limpar

                const container = document.createElement('div');
                container.style.cssText = 'background: #f8f9fa; padding: 20px; border-radius: 10px;';

                const title = document.createElement('h4');
                title.style.cssText = 'color: var(--bizzflow-primary); margin-bottom: 15px;';
                title.textContent = 'Relatório ' + 
                    (reportType === 'sales' ? 'de Vendas' : 
                     reportType === 'products' ? 'de Produtos' : 
                     reportType === 'clients' ? 'de Clientes' : 'Financeiro');

                const period = document.createElement('div');
                period.style.marginBottom = '15px';
                period.innerHTML = '<strong>Período:</strong> ' + startDate + ' a ' + endDate;

                const summary = document.createElement('div');
                summary.style.cssText = 'background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;';
                summary.innerHTML = 
                    '<strong>Resumo:</strong>' +
                    '<div style="margin-top: 10px;">' +
                        '<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">' +
                            '<span>Registos encontrados:</span>' +
                            '<span style="font-weight: 600;">' + (Math.floor(Math.random() * 100) + 50) + '</span>' +
                        '</div>' +
                        '<div style="display: flex; justify-content: space-between; margin-bottom: 8px;">' +
                            '<span>Total gerado:</span>' +
                            '<span style="font-weight: 600; color: #27ae60;">' + (Math.random() * 100000).toFixed(2) + ' MZN</span>' +
                        '</div>' +
                    '</div>';

                const button = document.createElement('button');
                button.className = 'btn btn-primary';
                button.innerHTML = '<i class="fas fa-download"></i> Exportar Relatório';
                button.onclick = function() {
                    if (typeof exportData === 'function') {
                        exportData(reportType, 'pdf');
                    } else {
                        console.warn('Função exportData não disponível');
                        alert('Funcionalidade de exportação em desenvolvimento');
                    }
                };

                // Montar
                container.appendChild(title);
                container.appendChild(period);
                container.appendChild(summary);
                container.appendChild(button);
                resultsDiv.appendChild(container);

                if (typeof showAlert === 'function') {
                    showAlert('Relatório gerado com sucesso!', 'success');
                } else {
                    console.log('✅ Relatório gerado com sucesso!');
                }
            }

            // Mostrar/ocultar datas personalizadas
            const dateRangeSelect = document.getElementById('dateRange');
            if (dateRangeSelect) {
                dateRangeSelect.addEventListener('change', function() {
                    const customDateRange = document.getElementById('customDateRange');
                    if (customDateRange) {
                        customDateRange.style.display = this.value === 'custom' ? 'block' : 'none';
                    }
                });
            }

            // Fechar modais ao clicar fora
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            };

            // Impedir que cliques dentro do conteúdo do modal fechem o modal
            document.querySelectorAll('.modal-content').forEach(function(content) {
                content.onclick = function(event) {
                    event.stopPropagation();
                };
            });
        }

        // ========== FIM DO CÓDIGO JAVASCRIPT ==========
        console.log('✅ Sistema BizzFlow CRM inicializado com sucesso!');
        
        // Inicializar eventos de relatório após carregamento
        document.addEventListener('DOMContentLoaded', function() {
            const dateRangeSelect = document.getElementById('dateRange');
            if (dateRangeSelect) {
                dateRangeSelect.addEventListener('change', function() {
                    const customDateRange = document.getElementById('customDateRange');
                    if (customDateRange) {
                        customDateRange.style.display = this.value === 'custom' ? 'block' : 'none';
                    }
                });
            }
            
            // Inicializar botão de gerar relatório
            const generateReportBtn = document.getElementById('generateReportBtn');
            if (generateReportBtn) {
                generateReportBtn.addEventListener('click', generateCustomReport);
            }
        });
    </script>
    <script src="js/functions.js"></script>
</body>
</html>
